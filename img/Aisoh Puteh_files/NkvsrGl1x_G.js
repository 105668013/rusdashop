/*!CK:4117826952!*//*1416324529,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["dunA2"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){e.exports={ACTION_EDUCATE:"educate",ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};},null);
__d("GenderConst",[],function(a,b,c,d,e,f){e.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;},null);
__d("Chat",["Arbiter"],function(a,b,c,d,e,f,g){var h={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(k,l){g.subscribe(h[k],function(event,m){l(m);});}var j={openBuddyList:function(){i('buddyListNub',function(k){k.show();i('sidebar',function(l){l.enable();});});},closeBuddyList:function(){i('buddyListNub',function(k){k.hide();});},toggleSidebar:function(){i('sidebar',function(k){k.toggle();});}};a.Chat=e.exports=j;},3);
__d("ChatQuietLinks",["Event","DOM","UserAgent_DEPRECATED","DataStore","Parent"],function(a,b,c,d,e,f,g,h,i,j,k){var l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","ShortProfiles","WorkModeConfig","createArrayFromMixed","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k){var l=[],m=[],n={},o=[],p={},q=[],r={contains:function(s){return s in n;},getList:function(){if(j.is_work_user)return k(l);r.reRank();var s=k(l);s=s.filter(function(t){var u=i.getNowUnsafe(t);return !u||u.type=="friend";});return s;},getRank:function(s){return s in n?n[s]:l.length;},getActiveList:function(){if(o.length>0)return o;return r.getList();},getActiveRank:function(s){return s in p?p[s]:r.getRank(s);},reRank:function(){l=[];var s=0;q.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(h.get(u)==v){l[s]=u;n[u]=s++;}});},rankActive:function(){var s=0;q.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(v==g.ACTIVE){o[s]=u;p[u]=s++;}});},getGroups:function(){return m;}};(function(){var s=b('InitialChatFriendsList');l=s.list.length?s.list:[];m=s.groups;if(!j.is_work_user){q=l.slice();r.rankActive();r.reRank();}else l.forEach(function(t,u){n[t]=u;});})();e.exports=a.OrderedFriendsList||r;},null);
__d("ChatMiniSidebarController",["Bootloader","React"],function(a,b,c,d,e,f,g,h){'use strict';var i=null,j=0,k=0,l=null,m=null,n=null,o=null,p={init:function(q,r,s){if(o)return;o=q;m=r;n=s;},setHeight:function(q){j=q;},setMaxItems:function(q){k=q;},show:function(){g.loadModules(["ChatMiniSidebar.react","ChatMiniSidebarSearchSource"],function(q,r){if(!i)i=new r({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});l=h.render(h.createElement(q,{dataSource:i,height:j,maxEntries:k,onToggleSidebar:n,onClickSearch:m,shown:true}),o);});},hide:function(){l&&l.setProps({dataSource:i,height:j,maxEntries:k,onToggleSidebar:n,onClickSearch:m,shown:false},function(){return m&&m(false);});}};e.exports=p;},null);
__d("ChatSidebarComposeLink.react",["ChatOpenTab","React","TooltipLink.react","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l=h.createClass({displayName:"ChatSidebarComposeLink",propTypes:{className:h.PropTypes.string.isRequired},componentDidMount:function(){g.listenOpenEmptyTab(this.getDOMNode(),'sidebar');},render:function(){var m="\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e43\u0e2b\u0e21\u0e48";return (h.createElement(i,{ajaxify:new j('/ajax/messaging/composer.php'),className:this.props.className,tooltip:m,rel:"dialog"}));}});e.exports=l;},null);
__d("ChatSidebarConstants",["mergeInto"],function(a,b,c,d,e,f,g){var h={LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};g(h,{getImageSize:function(i){if(i===false)return h.IMAGE_SIZE;return h.LITESTAND_CLASSIC_SIZE;},getItemHeight:function(i){if(i===false)return h.IMAGE_SIZE+4;return h.LITESTAND_CLASSIC_SIZE+4;}});e.exports=h;},null);
__d("ChatSidebarSheet",["ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","copyProperties","fbt","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=q.create('sidebar_sheet');function x(da){switch(da){case j.HINT_AUTH:return "\u0e40\u0e0b\u0e2a\u0e0a\u0e31\u0e19\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13\u0e2b\u0e21\u0e14\u0e40\u0e27\u0e25\u0e32 \u0e42\u0e1b\u0e23\u0e14\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a";case j.HINT_CONN:return t._("Facebook {Chat} \u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e44\u0e14\u0e49\u0e43\u0e19\u0e02\u0e13\u0e30\u0e19\u0e35\u0e49",[t.param("Chat","\u0e41\u0e0a\u0e17")]);case j.HINT_MAINT:return t._("Facebook {Chat} \u0e2b\u0e22\u0e38\u0e14\u0e43\u0e2b\u0e49\u0e1a\u0e23\u0e34\u0e01\u0e32\u0e23\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e14\u0e33\u0e40\u0e19\u0e34\u0e19\u0e01\u0e32\u0e23\u0e1a\u0e33\u0e23\u0e38\u0e07\u0e23\u0e31\u0e01\u0e29\u0e32\u0e2d\u0e22\u0e39\u0e48\u0e43\u0e19\u0e02\u0e13\u0e30\u0e19\u0e35\u0e49",[t.param("Chat","\u0e41\u0e0a\u0e17")]);default:return t._("Facebook {Chat} \u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e44\u0e14\u0e49\u0e43\u0e19\u0e02\u0e13\u0e30\u0e19\u0e35\u0e49",[t.param("Chat","\u0e41\u0e0a\u0e17")]);}}function y(da){var ea;if(da===null||false===navigator.onLine){ea="\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e01\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32 \u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e01\u0e32\u0e23\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e2d\u0e34\u0e19\u0e40\u0e17\u0e2d\u0e23\u0e4c\u0e40\u0e19\u0e47\u0e15\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13";}else if(da>l.get('warning_countdown_threshold_msec')){var fa=o.create('a',{href:'#',className:'fbChatReconnectLink'},"\u0e25\u0e2d\u0e07\u0e2d\u0e35\u0e01\u0e04\u0e23\u0e31\u0e49\u0e07");ea=t._("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e01\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32 {try-again-link}",[t.param("try-again-link",fa)]);}else if(da>1000){ea=t._("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e01\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32 \u0e01\u0e33\u0e25\u0e31\u0e07\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e43\u0e2b\u0e21\u0e48\u0e43\u0e19 {seconds}...",[t.param("seconds",Math.floor(da/1000))]);}else ea="\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e01\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32 \u0e01\u0e33\u0e25\u0e31\u0e07\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e21\u0e15\u0e48\u0e2d\u0e43\u0e2b\u0e21\u0e48...";return ea;}var z=u(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da){"use strict";this._root=da;this._message=o.find(da,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}ca.prototype._handleConnectionChange=function(da,ea){"use strict";this._channelStatus=da;this._channelData=ea;this._render();};ca.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,x(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var da=this._channelData;o.setContent(this._message,y(da));if(da>1000){if(da>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=v(this._handleConnectionChange.bind(this,i.RECONNECTING,da-1000),1000);}}};ca.prototype._renderOffline=function(){"use strict";var da='fbChatGoOnlineLink',ea="\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17",fa=o.create('a',{href:'#',className:da},ea),ga=t._("{=Go online}\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e14\u0e39\u0e27\u0e48\u0e32\u0e43\u0e04\u0e23\u0e1e\u0e23\u0e49\u0e2d\u0e21\u0e2a\u0e19\u0e17\u0e19\u0e32",[t.param("=Go online",fa)]);o.setContent(this._message,ga);this._goOnlineEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),da)){w.log('sidebar_go_online');m.goOnline();return false;}});};ca.prototype._renderBlackbirdUpsell=function(){"use strict";o.setContent(this._message,h.getOfflineContent());};ca.prototype._renderBlackbird=function(da){"use strict";o.setContent(this._message,h.getBlackbirdContent(da));};ca.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};ca.prototype._render=function(){"use strict";this._clear();if(h.shouldShow()){if(m.hasBlackbirdEnabled()){var da=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,da);this._renderBlackbird(r.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');var ea="\u0e01\u0e32\u0e23\u0e41\u0e08\u0e49\u0e07\u0e40\u0e15\u0e37\u0e2d\u0e19\u0e08\u0e30\u0e16\u0e39\u0e01\u0e1b\u0e34\u0e14\u0e02\u0e13\u0e30\u0e17\u0e35\u0e48\u0e04\u0e38\u0e13\u0e43\u0e0a\u0e49\u0e44\u0e04\u0e25\u0e40\u0e2d\u0e19\u0e15\u0e4c\u0e2d\u0e37\u0e48\u0e19\u0e43\u0e19\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17";o.setContent(this._message,ea);}this.inform('updated');};s(ca.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=ca;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","Banzai","BanzaiLogger","BootloaderConfig","ChatConfig","ChatImpressionLogger","ChatOptions","ChatMiniSidebarController","ChatSidebarComposeLink.react","ChatSidebarConstants","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","JSLogger","KeyEventController","LitestandClassicPlaceHolders","OrderedFriendsList","Parent","PresencePrivacy","React","ScrollableArea","SidebarFitWindowHeight","Style","ViewportBounds","copyProperties","createArrayFromMixed","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){var pa,qa=null,ra=false,sa=false,ta=false,ua=false,va=false,wa=false,xa,ya=false,za,ab,bb,cb,db,eb,fb,gb=null,hb,ib=x.create('chat_sidebar'),jb='succeeded',kb=k.create(ia({retry:true},j.VITAL));function lb(){t.removeClass(document.documentElement,'sidebarMode');if(!va||(!wb.isVisible()&&!ua)){g.inform('reflow');return;}ta=false;ua=false;gb=null;cb.hide();eb.getCore().reset();t.hide(ab);if(ya){t.hide(xa);t.hide(za);t.removeClass(document.documentElement,'miniSidebar');t.removeClass(ab,"_51xq");p.hide();ib.log('minisidebar_hide');}else ib.log('sidebar_hide');g.inform('sidebar/hide',wb);g.inform('reflow');}function mb(){var xb=wb.shouldShowSidebar(),yb=wb.shouldShowMiniSidebar();if(wb.isEnabled()&&(xb||yb)){if(xb){pb();qb();}else sb();}else lb();if(!va){vb();va=true;}gb=null;}function nb(){if(eb&&wb.isVisible())eb.getCore().getElement().focus();}function ob(xb){var yb=fb.height;xb.forEach(function(zb){if(zb&&zb!==pa)yb-=v.getElementDimensions(zb).height;});if(hb)yb-=hb.getOffset();if(db)yb-=v.getElementDimensions(db).height;return Math.max(0,yb);}function pb(){if(wb.isVisible())return;if(ya){t.hide(xa);t.show(za);t.removeClass(document.documentElement,'miniSidebar');t.removeClass(ab,"_51xq");p.hide();}ta=true;ua=false;gb=null;t.show(ab);t.addClass(document.documentElement,'sidebarMode');cb.show();ib.log('sidebar_show');g.inform('sidebar/show',wb);z.destroy('sidebar');}function qb(){var xb=ob(ja(za.childNodes)),yb=cb.getItemHeight(),zb=8,ac=Math.floor((xb-zb)/yb);ga.set(pa,'height',xb+'px');cb.setNumTopFriends(ac);var bc=Math.floor((xb-zb)/yb);bc=(bc-2)>0?bc-2:0;eb.getData().setMaxResults(bc);g.inform('sidebar/resized',wb);g.inform('reflow');}function rb(xb){if(ab===null)return;t.conditionClass(ab,"_2e4g",xb);}function sb(){if(ua)return;t.hide(za);t.show(xa);t.show(ab);t.addClass(document.documentElement,'sidebarMode');t.addClass(document.documentElement,'miniSidebar');t.addClass(ab,"_51xq");var xb=ob([]),yb=r.getItemHeight(true);p.setHeight(xb);var zb=Math.floor(xb/yb)-2;p.setMaxItems(zb>0?zb:0);p.show();ta=false;ua=true;z.destroy('sidebar');ib.log('minisidebar_show');g.inform('minisidebar/show',wb);g.inform('reflow');}function tb(){o.setSetting('sidebar_mode',wb.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(na).setErrorHandler(na).setData({sidebar_mode:wb.isEnabled()}).setAllowCrossPageTransition(true).send();}function ub(){return aa.getActiveList().length<=m.get('sidebar.min_friends');}function vb(){var xb=true;if(!wb.isEnabled()){ib.log('state_not_enabled');xb=false;}if(!wb.isViewportCapable())if(!ya){ib.log('state_not_shown_viewport');xb=false;}else if(!wb.isViewportCapableForMiniSidebar()){ib.log('state_not_shown_viewport_mini');xb=false;}if(sa){ib.log('state_not_shown_hidden');xb=false;}if(ub()){ib.log('state_not_shown_num_friends');xb=false;}ib.log(xb?'state_shown':'state_not_shown');}var wb={init:function(xb,yb,zb,ac){wb.init=na;wa=true;ab=xb;cb=yb;eb=zb;bb=ac;pa=u.find(xb,'div.fbChatSidebarBody');xa=u.find(xb,"._51x-");za=u.find(xb,"._51x_");db=u.find(xb,"._5qqe");ya=m.get('www_mini_sidebar',false);if(ya)p.init(xa,rb,function(){return wb.toggle();});if(ac&&ac.react_compose_link){var bc=u.find(xb,"._x1u");bc&&da.render(da.createElement(q,{className:"_3a-4 _5q85"}),bc);}w.listen(window,'resize',mb);y.registerKey('q',function(event){if(ta){if(!qa)qa=u.scry(xb,'.inputsearch')[0];if(qa){qa.focus();event.prevent();}}});var cc=new s(xb);cc.subscribe('updated',mb);cb.setScrollContainer(ba.byClass(cb.getRoot(),'uiScrollableAreaWrap'));cb.subscribe(['render','show','hide'],ma(function(ec){var fc=ea.getInstance(cb.getRoot());fc&&fc.adjustGripper();}));g.subscribe('chat/option-changed',function(ec,fc){if(fc.name=="sidebar_mode"){ra=!!o.getSetting('sidebar_mode');mb();}if(fc.name==='hide_groups')mb();});zb.getCore().subscribe('sidebar/typeahead/active',wb.updateOnActiveTypeahead);zb.subscribe('reset',function(){if(!zb.getCore().getValue()&&!cb.isVisible())wb.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(ec,fc){w.listen(fc.getButton(),'click',function(event){var gc=sa;sa=false;wb.enable();var hc=wb.shouldShowSidebar()||wb.shouldShowMiniSidebar();sa=gc&&!hc;return !hc;});});ra=!!o.getSetting('sidebar_mode');ca.subscribe('privacy-user-presence-changed',mb);mb();n.init(cb);ha.addPersistentRight(wb.getVisibleWidth);wb.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);hb=new fa(db);hb.subscribe('resized',mb);if(m.get('chat_sidebar_load_log')){var dc={event:jb,session_token:ac.session_token,country_code:ac.viewer_country_code,buddylist_short:m.get('buddylist_short_group'),bootloader_retry:l.retry_on_timeout};kb.log('MessagesSidebarLoadLoggerConfig',dc);}},updateOnActiveTypeahead:function(xb,yb){if(!ta)return;if(yb){cb.hide();}else{cb.show();mb();}},isInitialized:function(){return va;},disable:function(){if(!wb.isEnabled())return;ra=false;tb();lb();},enable:function(){if(wb.isEnabled())return;ra=true;tb();mb();setTimeout(nb,0);},ensureLoaded:function(){if(!ra)return;if(wa)return;if(oa('pagelet_sidebar'))return;d(['UIPagelet'],function(xb){var yb=u.create('div',{id:'pagelet_sidebar'});u.appendContent(document.body,yb);xb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});wa=true;},hide:function(){if(sa)return;sa=true;lb();},unhide:function(){if(!sa)return;sa=false;mb();},getBody:function(){return pa;},getRoot:function(){return ab;},getVisibleWidth:function(){if((!ta&&!ua)||!ab)return 0;if(gb===null){gb=ab.offsetWidth;if(ua)gb=206;}return gb;},isEnabled:function(){return ra;},isViewportCapable:function(){fb=v.getViewportWithoutScrollbarDimensions();var xb=m.get('sidebar.minimum_width');return fb.width>xb;},shouldShowSidebar:function(){var xb=wb.isViewportCapable();return xb&&!sa&&!ub();},isViewportCapableForMiniSidebar:function(){fb=v.getViewportWithoutScrollbarDimensions();var xb=m.get('sidebar.minimum_width'),yb=m.get('minisidebar.minimum_width');return fb.width>yb&&fb.width<=xb;},shouldShowMiniSidebar:function(){if(!ya)return false;var xb=wb.isViewportCapableForMiniSidebar();return xb&&!sa&&!ub();},isVisible:function(){return ta;},resize:mb,toggle:function(){wb.isEnabled()?wb.disable():wb.enable();}};ia(wb,h);e.exports=wb;},null);
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;},null);
__d("ChatTypeaheadBehavior",["ChatOpenTab","CSS","Parent","Rect","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(o,p){var q=i.byClass(o,"_4oes");if(q)h.conditionClass(q,"_5q83",p);}function n(o){"use strict";this._typeahead=o;}n.prototype.enable=function(){"use strict";var o=this._typeahead;this._subscriptions=[o.subscribe('focus',function(){o.getData().refreshData();m(o.getElement(),true);}),o.subscribe('blur',function(p){o.getCore().reset();m(o.getElement(),false);}),o.subscribe('respond',function(p,q){if(q.value&&q.value===o.getCore().getValue()){if(!q.results.length){var r=q.value.toLowerCase(),s=o.getData().getQueryCache();if(!q.isAsync&&!s.hasOwnProperty(r))return;o.getView().showNoResults();}h.addClass(o.getElement(),'hasValue');}}),o.subscribe('reset',function(){h.removeClass(o.getElement(),'hasValue');}),o.subscribe('select',function(p,q){var r=q.selected.uid;if(q.selected.mercury_thread&&!q.selected.mercury_thread.is_canonical)r=q.selected.mercury_thread.thread_fbid;o.getView().hide();g.openTabByType(r,q.selected.type,'typeahead');}),o.subscribe('highlight',function(p,q){if(q.index>=0){var r=o.getView().getItems()[q.index];if(r){var s=new j(r),t=r.offsetParent,u=s.boundWithin(new j(t)).getPositionVector();s.getPositionVector().sub(u).scrollElementBy(t);}}})];};n.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(o){this._typeahead.unsubscribe(o);},this);this._subscriptions=null;};k(n.prototype,{_subscriptions:null});e.exports=n;},null);
__d("ContentRollTypeaheadView.react",["BackgroundImage.react","ImageBlock.react","ScrollableArea.react","React","TypeaheadViewItem","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:"ContentRollTypeaheadViewItem",mixins:[k.Mixin],propTypes:k.propTypes,render:function(){var p=this.props.entry,q=p.getSubtitle()?j.createElement("div",{className:"_599q"},p.getSubtitle()):null;if(q&&p.getAuxiliaryData()&&p.getAuxiliaryData().icon)q=j.createElement(h,{spacing:"small"},j.createElement(g,{width:16,height:16,src:p.getAuxiliaryData().icon}),q);var r=p.getPhoto()?j.createElement(g,{width:32,height:32,backgroundSize:"cover",src:p.getPhoto()}):j.createElement("span",null),s=(("_5yww")+(!q?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''));return (j.createElement("li",{className:s,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight},j.createElement(h,{spacing:"medium"},r,j.createElement("div",null,j.createElement("div",{className:"_599p"},p.getTitle()),q))));}}),o=j.createClass({displayName:"ContentRollTypeaheadView",propTypes:{highlightedEntry:j.PropTypes.object,entries:j.PropTypes.array.isRequired,onSelect:j.PropTypes.func.isRequired,onHighlight:j.PropTypes.func,onRenderHighlight:j.PropTypes.func,scrollableAreaHeight:j.PropTypes.number.isRequired,scrollableAreaWidth:j.PropTypes.number.isRequired},_renderItem:function(p){var q=p===this.props.highlightedEntry;return (j.createElement(n,{key:p.getUniqueID(),entry:p,highlighted:q,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var p=(("_2072")+(!this.props.entries.length?' '+"_599s":'')),q=this.props.entries,r={};q.forEach(function(v){r[v.getType()]=r[v.getType()]||[];r[v.getType()].push(v);});var s=[];for(var t in r){var u=null;switch(t){case 'recent':u="Recently Viewed Links";break;case 'saved':u="Saved Links";break;case 'bing':u="Bing Results";break;}if(u)s.push(j.createElement("div",{className:"_1opo"},u));r[t].forEach(function(v){s.push(this._renderItem(v));},this);}return (j.createElement("div",{className:p},j.createElement(i,{height:this.props.scrollableAreaHeight,width:this.props.scrollableAreaWidth},j.createElement("ul",null,s))));}});e.exports=o;},null);
__d("ContentRollTypeahead.react",["AbstractTypeahead.react","React","ReactPropTypes","WebAsyncSearchSource","ContentRollTypeaheadView.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=20,o='/ajax/metacomposer/attachment/og/typeahead/content_roll',p=h.createClass({displayName:"ContentRollTypeahead",propTypes:{className:i.string,onSelection:i.func.isRequired,scrollableAreaHeight:h.PropTypes.number.isRequired,scrollableAreaWidth:h.PropTypes.number.isRequired,userID:i.string.isRequired,useLayer:i.bool},getInitialState:function(){return {query:''};},_handleChange:function(event){this.setState({query:event.target.value});},_handleSelectAttempt:function(q){this.setState({query:''});var r={object_id:q.getUniqueID(),url:q.getURI(),source:q.getType(),query:q.getAuxiliaryData().query,subindex:q.getAuxiliaryData().subindex,subtotal:q.getAuxiliaryData().subtotal,index:q.getAuxiliaryData().index,total:q.getAuxiliaryData().total};this.props.onSelection(r);},_getSearchSource:function(){if(!this._searchSource)this._searchSource=new j({bootstrapRequests:[{uri:o,data:{viewer:this.props.userID}}],queryRequests:[{uri:o,data:{viewer:this.props.userID}}],getAllForEmptyQuery:true});return this._searchSource;},_getPlaceholder:function(){if(!this._placeholder)this._placeholder="Search for articles, videos, music, and more";return this._placeholder;},focusInput:function(){this.refs.typeahead.focusInput();},render:function(){var q={ViewRenderer:k,maxEntries:n,useLayer:this.props.useLayer,extraRendererProps:{scrollableAreaHeight:this.props.scrollableAreaHeight,scrollableAreaWidth:this.props.scrollableAreaWidth}};return (h.createElement(g,{autoHighlight:true,className:this.props.className,focusedOnInit:true,inputClassName:"_55r1",onChange:this._handleChange,onSelectAttempt:this._handleSelectAttempt,placeholder:this._getPlaceholder(),presenter:q,queryString:this.state.query,ref:"typeahead",searchSource:this._getSearchSource(),showEntriesOnFocus:true}));}});e.exports=p;},null);
__d("ContentRollFlyout.react",["ContentRollTypeahead.react","Parent","React","ReactPropTypes","Toggler","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:"ContentRollFlyout",propTypes:{onSelection:j.func.isRequired,userID:j.string.isRequired},getInitialState:function(){return {showFlyout:false};},componentDidMount:function(){var n=this._getParentToggler();if(n)k.listen('show',n,function(){this.setState({showFlyout:true});}.bind(this));},_getParentToggler:function(){return h.byClass(this.getDOMNode(),'uiToggle');},_hideParentToggler:function(){var n=this._getParentToggler();if(n)k.hide(n);},_handleSelection:function(n){this._hideParentToggler();this.props.onSelection(n);},render:function(){if(!this.state.showFlyout)return i.createElement("div",null);return (i.createElement(g,{className:"_5j11",onSelection:this._handleSelection,scrollableAreaHeight:288,scrollableAreaWidth:256,userID:this.props.userID,useLayer:false}));}});e.exports=m;},null);
__d("getURLRanges",["URI","URLScraper"],function(a,b,c,d,e,f,g,h){"use strict";function i(j,k){k=k||0;var l=h.match(j);if(!l)return [];var m=l;if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(l)))m='http://'+l;if(!g.isValidURI(m))return [];k+=j.indexOf(l);var n=l.length,o=[{offset:k,length:l.length,entity:{url:m}}];return o.concat(i(j.substr(k+n),k+n));}e.exports=i;},null);
__d("MercuryMessageBody.react",["React","Link.react","ReactComponentWithPureRenderMixin","TextWithEntities.react","cx","fbt","getURLRanges"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=function(p,q){return (g.createElement(h,{target:"_blank",href:q.entity},p));},o=g.createClass({displayName:"MercuryMessageBody",mixins:[i],propTypes:{body:g.PropTypes.string,ranges:g.PropTypes.array},render:function(){var p=this.props.body||'';if(p.startsWith('?OTR'))return (g.createElement("span",{className:"_89h"},"[\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e17\u0e35\u0e48\u0e40\u0e02\u0e49\u0e32\u0e23\u0e2b\u0e31\u0e2a]"));p=p.replace(/\s+$/,'');if(p.length===0)return null;var q=this.props.ranges;if(q==(void 0))q=m(p);return (g.createElement(j,{interpolator:n,text:p,ranges:q,renderEmoticons:true,renderEmoji:true}));}});e.exports=o;},null);
__d("XUIAmbientNUXTheme",["cx"],function(a,b,c,d,e,f,g){var h={wrapperClassName:"_2x6q",arrowDimensions:{offset:14,length:18}};e.exports=h;},null);
__d("XUIAmbientNUX.react",["HasLayerContextMixin","React","ReactLayer","ReactAbstractContextualDialog","XUIAmbientNUXTheme","XUICloseButton.react","XUIContextualDialogBody.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=h.PropTypes,p=300,q=380,r=i.createClass(j.createSpec({displayName:'XUIAmbientNUX',theme:k})),s=h.createClass({displayName:"XUIAmbientNUX",mixins:[g],propTypes:{alignment:o.oneOf(['left','center','right']),behaviors:o.object,context:o.object,contextRef:o.string,customwidth:o.number,offsetX:o.number,offsetY:o.number,onCloseButtonClick:o.func,position:o.oneOf(['above','below','left','right']),shown:o.bool,width:o.oneOf(['wide','normal','auto','custom'])},_getWidth:function(){switch(this.props.width){case 'wide':return q;case 'custom':return this.props.customwidth;case 'auto':return null;default:return p;}},render:function(){return (h.createElement(r,{alignment:this.props.alignment,autoFocus:false,behaviors:this.props.behaviors,context:this.getContextNode(),focusContextOnHide:false,offsetX:this.props.offsetX,offsetY:this.props.offsetY,position:this.props.position,shown:this.props.shown,width:this._getWidth(this.props)},h.createElement("div",{className:"_53iv"},h.createElement(m,null,h.createElement(l,{shade:"light",className:"_36gl",onClick:this.props.onCloseButtonClick}),h.createElement("div",{className:"_36gn"},this.props.children)))));}});e.exports=s;},null);
__d("Dock",["Event","shield","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","csx","emptyFunction","WebMessengerWidthControl"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b('WebMessengerWidthControl');function v(){}s(v,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(w){this.init=u;this.rootEl=w;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(w,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));q.subscribe(['show','hide'],function(x,y){var z=y.getActive();if(!n.contains(w,z))return;if(l.hasClass(z,'fbNub')){this.notifyNub(z,x);if(x==='show')this._resizeNubFlyout(z);}else{var aa=o.byClass(z,'fbNubFlyout');if(aa)l.conditionClass(aa,'menuOpened',x==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=r.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+r.getElementDimensions(this.rootEl).y;var w=n.scry(document,"div._4f7n")[0];if(w){var x=p.isFixed(w)?'viewport':'document';this.flyoutHeightOffset+=r.getElementPosition(w,x).y+r.getElementDimensions(w).y;}},toggle:function(w){var x=this._findFlyout(w);if(!x)return;this.subscribe('init',function(){q.toggle(w);});},show:function(w){this.subscribe('init',function(){q.show(w);});},showNub:function(w){l.show(w);},hide:function(w){this.subscribe('init',function(){var x=q.getInstance(w);n.contains(w,x.getActive())&&x.hide();});},hideNub:function(w){l.hide(w);this.hide(w);},setUseMaxHeight:function(w,x){l.conditionClass(w,'maxHeight',x!==false);this._resizeNubFlyout(w);},_resizeNubFlyout:function(w){var x=this._findFlyout(w);if(!x||!(l.hasClass(w,'openToggler')||l.hasClass(w,'opened')))return;var y=n.find(x,'div.fbNubFlyoutOuter'),z=n.find(y,'div.fbNubFlyoutInner'),aa=n.find(z,'div.fbNubFlyoutBody'),ba=aa.scrollTop,ca=aa.offsetHeight;p.set(aa,'height','auto');var da=r.getElementDimensions(x),ea=r.getElementDimensions(aa),fa=this.getMaxFlyoutHeight(w);p.set(x,'max-height',fa+'px');p.set(y,'max-height',fa+'px');da=r.getElementDimensions(x);var ga=r.getElementDimensions(z),ha=ga.y-ea.y,ia=da.y-ha,ja=parseInt(aa.style.height||aa.clientHeight,10),ka=ia!==ja;if(da.y>ha&&ka)p.set(aa,'height',ia+'px');l.removeClass(x,'swapDirection');var la=r.getElementPosition(x).x;l.conditionClass(x,'swapDirection',function(){if(la<0)return true;return (la+da.x>this.viewportDimensions.x);}.bind(this)());if(ka&&ba+ca>=ea.y){aa.scrollTop=aa.scrollHeight;}else aa.scrollTop=ba;this.notifyNub(w,'resize');},getMaxFlyoutHeight:function(w){var x=this._findFlyout(w),y=r.getElementPosition(x,'viewport'),z=r.getElementDimensions(x),aa=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-y.y-z.y);return Math.max(aa,0);},resizeAllFlyouts:function(){var w=this._getAllNubs(),x=w.length;while(x--)this._resizeNubFlyout(w[x]);},hideAllFlyouts:function(){var w=this._getAllNubs(),x=w.length;while(x--)this.hide(w[x]);},_getAllNubs:function(){var w=n.scry(this.rootEl,"div._50-v.openToggler");return w.concat(n.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var w=event.getTarget(),x=o.byClass(w,'fbNub');if(x){if(o.byClass(w,'fbNubFlyoutTitlebar')){var y=o.byTag(w,'a'),z=w.nodeName=='INPUT'&&w.getAttribute('type')=='submit';if(!y&&!z){this.hide(x);return false;}}this.notifyNub(x,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(w){return l.hasClass(w,'fbNubFlyout')?w:n.scry(w,'div.fbNubFlyout')[0]||null;},registerNubController:function(w,x){m.set(w,'dock:nub:controller',x);x.subscribe('nub/button/content-changed',h(this.inform,this,'resize',w));x.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,w));},unregisterNubController:function(w){m.remove(w,'dock:nub:controller');},notifyNub:function(w,x,y){var z=m.get(w,'dock:nub:controller');z&&z.inform(x,y);}});e.exports=a.Dock||v;},null);
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;},null);
__d("DataViewPolyfill",[],function(a,b,c,d,e,f){"use strict";function g(h,i,j){if(i===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h);}else if(j===(void 0)){this.$DataViewPolyfill0=new Uint8Array(h,i);}else this.$DataViewPolyfill0=new Uint8Array(h,i,j);this.byteLength=this.$DataViewPolyfill0.byteLength;}g.prototype.getUint8=function(h){if(h>=this.$DataViewPolyfill0.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill0[h];};g.prototype.getUint16=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1);return i?(k*256)+j:(j*256)+k;};g.prototype.getUint32=function(h,i){var j=this.getUint8(h),k=this.getUint8(h+1),l=this.getUint8(h+2),m=this.getUint8(h+3);return i?(((m*256+l)*256+k)*256)+j:(((j*256+k)*256+l)*256)+m;};g.isSupported=function(){return !!a.Uint8Array;};e.exports=g;},null);
__d("OrderedMap",["Object.assign","invariant"],function(a,b,c,d,e,f,g,h){"use strict";var i='key:';function j(q,r){var s={};for(var t=0;t<q.length;t++){var u=q[t],v=r(u);l(v);var w=i+v;h(!(w in s));s[w]=u;}return s;}function k(q,r){this._normalizedObj=q;this._computedPositions=null;this.length=r;}function l(q){h(q!==''&&(typeof q==='string'||typeof q==='number'));}function m(q,r,s){h(typeof q==='number'&&typeof r==='number'&&r>=0&&q>=0&&q+r<=s);}function n(q,r){h(q&&q.constructor===Object&&(!r||r.constructor===Object));var s={},t=0,u;for(u in q)if(q.hasOwnProperty(u)){s[u]=q[u];t++;}for(u in r)if(r.hasOwnProperty(u)){if(!(u in s))t++;s[u]=r[u];}return new k(s,t);}var o={has:function(q){l(q);var r=i+q;return r in this._normalizedObj;},get:function(q){l(q);var r=i+q;return this.has(q)?this._normalizedObj[r]:(void 0);},merge:function(q){h(q instanceof k);return n(this._normalizedObj,q._normalizedObj);},map:function(q,r){return this.mapRange(q,0,this.length,r);},mapRange:function(q,r,s,t){var u=this._normalizedObj,v={},w=0;m(r,s,this.length);var x=r+s-1;for(var y in u)if(u.hasOwnProperty(y)){if(w>=r){if(w>x)break;var z=u[y];v[y]=q.call(t,z,y.substr(i.length),w);}w++;}return new k(v,s);},filter:function(q,r){return this.filterRange(q,0,this.length,r);},filterRange:function(q,r,s,t){var u={},v=0;this.forEachRange(function(w,x,y){if(q.call(t,w,x,y)){var z=i+x;u[z]=w;v++;}},r,s);return new k(u,v);},forEach:function(q,r){this.forEachRange(q,0,this.length,r);},forEachRange:function(q,r,s,t){m(r,s,this.length);var u=this._normalizedObj,v=0,w=r+s-1;for(var x in u)if(u.hasOwnProperty(x)){if(v>=r){if(v>w)break;var y=u[x];q.call(t,y,x.substr(i.length),v);}v++;}},mapKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);h(u!==(void 0)&&v!==(void 0));h(v>=u);return this.mapRange(q,u,(v-u)+1,t);},forEachKeyRange:function(q,r,s,t){var u=this.indexOfKey(r),v=this.indexOfKey(s);h(u!==(void 0)&&v!==(void 0));h(v>=u);this.forEachRange(q,u,(v-u)+1,t);},keyAtIndex:function(q){var r=this._getOrComputePositions(),s=r.keyByIndex[q];return s?s.substr(i.length):(void 0);},keyAfter:function(q){return this.nthKeyAfter(q,1);},keyBefore:function(q){return this.nthKeyBefore(q,1);},nthKeyAfter:function(q,r){var s=this.indexOfKey(q);h(s!==(void 0));return this.keyAtIndex(s+r);},nthKeyBefore:function(q,r){return this.nthKeyAfter(q,-r);},indexOfKey:function(q){l(q);var r=i+q,s=this._getOrComputePositions(),t=s.indexByKey[r];return t===(void 0)?(void 0):t;},toArray:function(){var q=[],r=this._normalizedObj;for(var s in r)if(r.hasOwnProperty(s))q.push(r[s]);return q;},_getOrComputePositions:function(){var q=this._computedPositions;if(!q)this._computePositions();return this._computedPositions;},_computePositions:function(){this._computedPositions={keyByIndex:{},indexByKey:{}};var q=this._computedPositions.keyByIndex,r=this._computedPositions.indexByKey,s=0,t=this._normalizedObj;for(var u in t)if(t.hasOwnProperty(u)){q[s]=u;r[u]=s;s++;}}};g(k.prototype,o);var p={from:function(q){h(q instanceof k);return n(q._normalizedObj,null);},fromArray:function(q,r){h(Array.isArray(q));h(typeof r==='function');return new k(j(q,r),q.length);}};e.exports=p;},null);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;},null);
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areJSONRepresentationsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=175,v=269,w=0;function x(){return u;}function y(){return v;}function z(aa){this._root=aa;var ba=this._recalculateWidth.bind(this);m.listen(window,'resize',ba);j.subscribe('resize',ba);g.subscribeOnce('sidebar/initialized',ba,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(z.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var aa=z._getAvailableDockWidth(this._root),ba=Math.max(1,Math.floor(aa/y())),ca=ba!=this._maxShown;if(!this._viewState||ca||aa<=this._viewState.usedWidth||aa>this._viewState.widthToShowNext){this._availableWidth=aa;this._maxShown=ba;this._viewState=null;this._recalculateTabs(ca);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(aa){var ba=z._getTabsToShow(i.get(),this._availableWidth);if(aa||!q(this._viewState,ba)){this._viewState=ba;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>y();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var aa=i.get(),ba=this._viewState.tabsToShow;return aa.tabs.filter(function(ca){return ba[ca.id];});},getRightmostHiddenTab:function(){var aa=i.get(),ba=this._viewState.tabsToShow,ca=aa.tabs.filter(function(ea){return !ba[ea.id];}),da=ca.shift();return da?da.id:null;},getLeftmostVisibleTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.pop();return ba?ba.id:null;},getRightmostRaisedTab:function(){var aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(i.getTab(aa[ca].id).raised)return aa[ca].id;return null;},getRaisedVisibleTabs:function(){var aa=[],ba=this.getShowingTabsOrder(),ca=ba.length;for(var da=0;da<ca;da++)if(i.getTab(ba[da].id).raised)aa.push(ba[da].id);return aa;},shouldPromoteOnRaise:function(aa){if(!this._viewState.tabsToShow[aa])return true;if(this._viewState.nextToHide!=aa)return false;var ba=i.getTab(aa),ca=ba&&ba.raised;return !ca&&(this._availableWidth-this._viewState.usedWidth<y()-x());}});r(z,{_getAvailableDockWidth:function(aa){var ba=l.getViewportWithoutScrollbarDimensions().width;ba-=p.getLeft()+p.getRight();ba-=50;var ca=n.byClass(aa,'fbDock'),da=k.find(ca,"._56ox"),ea=o.getElementDimensions(da).x;ba-=ea;var fa=k.scry(ca,"._56oy");ea+=o.getElementDimensions(fa.pop()).x;var ga=o.getElementDimensions(ca),ha=ga.x-ea;if(ha>w)w=ha;ba-=w;ba-=15;return Math.max(ba,0);},_getTabsToShow:function(aa,ba){ba=Math.max(ba,y()+1);function ca(sa,ta){return (sa.raised||!ta)?y():x();}var da=JSON.parse(JSON.stringify(aa.tabs)),ea=-1,fa=null;if(aa.promoted)da.forEach(function(sa,ta){if(sa.id===aa.promoted){ea=ta;fa=sa;}});var ga=0,ha=false,ia=0,ja=!fa;da.forEach(function(sa,ta){var ua=ca(sa,ha);ha=ha||!sa.raised;sa.leftmostOffset=ga+ua;ga+=ua;if(sa.leftmostOffset<ba)ia++;ja|=ta==ea;sa.alreadyPlacedPromoted=ja;});function ka(sa,ta,ua){var va={};for(var wa=0;wa<ta;wa++){var xa=sa[wa];if(!xa.alreadyPlacedPromoted&&wa==ta-1){va[ua]=true;}else va[xa.id]=true;}return va;}var la=ka(da,ia,aa.promoted),ma=ka(da,ia-1,aa.promoted),na=null;for(var oa in la)if(!ma[oa])na=oa;var pa=da[ia-1],qa=pa?pa.leftmostOffset:0,ra=Infinity;if(ia<da.length)ra=da[ia].leftmostOffset;return {nextToHide:na,tabsToShow:la,usedWidth:qa,widthToShowNext:ra};}});e.exports=z;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryIDs"],function(a,b,c,d,e,f,g,h,i){var j={};function k(l){var m=i.getUserIDFromThreadID(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification("\"You were tagged in a message!\"",{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("ChatAddToThreadButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:"ChatAddToThreadButton",mixins:[h],propTypes:{onClick:i.PropTypes.func,shown:i.PropTypes.bool},render:function(){var n="\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19\u0e17\u0e35\u0e48\u0e08\u0e30\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e14\u0e49\u0e27\u0e22\u0e2d\u0e35\u0e01",o=j.getTrackingInfo(j.types.ADD_TO_THREAD);return (i.createElement(g,{"aria-label":n,className:(("addToThread")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":o,"data-hover":"tooltip","data-tooltip-alignv":"top",onClick:this.props.onClick}));}});e.exports=m;},null);
__d("ChatArchiveWarning.react",["Image.react","ReactComponentWithPureRenderMixin","React","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i.createClass({displayName:"ChatArchiveWarning",mixins:[h],propTypes:{isFBAtWork:i.PropTypes.bool,shown:i.PropTypes.bool},render:function(){var m=this.props.isFBAtWork?k('images/chat/tab/archive-grey.png'):k('images/chat/tab/archive.png');return (i.createElement(g,{src:m,className:(("titanArchiveWarning")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-hover":"tooltip","data-tooltip-alignh":"center","aria-label":"All employee-to-employee conversations will be archived"}));}});e.exports=l;},null);
__d("ChatCloseButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=i.createClass({displayName:"ChatCloseButton",mixins:[h],propTypes:{onClick:i.PropTypes.func,onKeyUp:i.PropTypes.func,onMouseDown:i.PropTypes.func,active:i.PropTypes.bool},getDefaultProps:function(){return {active:false};},render:function(){var m=j.getTrackingInfo(j.types.CLOSE_BUTTON),n="\u0e01\u0e14 Esc \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e1b\u0e34\u0e14",o="\u0e1b\u0e34\u0e14\u0e41\u0e17\u0e47\u0e1a";return (i.createElement(g,{"aria-label":this.props.active?n:o,className:"close button","data-ft":m,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp,onMouseDown:this.props.onMouseDown}));}});e.exports=l;},null);
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryIDs","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getUserIDFromThreadID(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;},null);
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=60000,o=false,p=function(w,x){this._videoCallTour=new k();this._threadID=w;this._tabMainElement=x;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function q(w,event,x){if(w._openDialog)w._openDialog.updatePosition();}function r(w){if(w._openDialog)w._openDialog.updatePosition();}function s(w){if(w._openDialog){w._openDialog.hide();w._openDialog=null;}if(w._timeout){clearTimeout(w._timeout);w._timeout=null;}while(w._subscriptionTokens.length)w._subscriptionTokens.pop().unsubscribe();if(w._scrollListener){w._scrollListener.remove();w._scrollListener=null;}}function t(w,event,x){if(x.thread_id===w._threadID){w._openDialog=x.dialog;v(w);w._timeout=m(w.destroy.bind(w,w._threadID),n);w._scrollListener=g.listen(window,'scroll',r.bind(null,w));}}function u(w,x){if(!w._openDialog){w._subscriptionTokens.push(x.subscribe('chat/dialog-rendered',t.bind(null,w)));x.render(w._tabMainElement,w._threadID);}}function v(w){w._subscriptionTokens.push(i.subscribe('chat/tabs-changed',q.bind(null,w)),p.subscribe('dialog/close-all',s.bind(null,w)));}l(p,h);l(p.prototype,{destroy:function(){s(this);},tabFocused:function(){if(o){u(this,this._videoCallTour);return;}},tabNotActive:function(){s(this);},hideVideoCallouts:function(){s(this);}});j.subscribe('videocallingtour/start',function(){o=true;p.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){o=false;});e.exports=p;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";function aa(){return 'upload_'+r.getNewID();}var ba=z(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(fa,ga,ha){this.$ChatAutoSendPhotoUploader0=ha;this.$ChatAutoSendPhotoUploader1=ga;this.$ChatAutoSendPhotoUploader2=new s();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=fa.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(fa,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ia=i.find(fa,"._4q60"),ja=i.find(ia,"._4q61");new m(ia,ja,ga);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader7.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploadera.bind(this)),j.listen(ja,'click',function(){if(this.$ChatAutoSendPhotoUploaderb)if(o.prepareResource)o.prepareResource();this.inform('open');}.bind(this)));this.$ChatAutoSendPhotoUploaderb=o.isSupported();if(this.$ChatAutoSendPhotoUploaderb)this.$ChatAutoSendPhotoUploader6.setPreprocessHandler(this.$ChatAutoSendPhotoUploaderc.bind(this));}ea.prototype.isUploading=function(){return !y(this.$ChatAutoSendPhotoUploader3);};ea.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};ea.prototype.$ChatAutoSendPhotoUploaderd=function(fa,ga){var ha=this.$ChatAutoSendPhotoUploadere(fa);if(ga){ha.preview_width=ga.width;ha.preview_height=ga.height;}return ha;};ea.prototype.$ChatAutoSendPhotoUploadere=function(fa){var ga={upload_id:fa,on_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ha));}.bind(this),on_resizing_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ha));}.bind(this),on_success:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ha));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderf.bind(this),attach_type:p.PHOTO,preview_uploading:true};return ga;};ea.prototype.$ChatAutoSendPhotoUploaderc=function(fa,ga){var ha=fa.getFile();if(!q(ha.type).isJpeg())return ga(fa);o.getSingleton().resizeBlob(ha,function(ia,ja,ka){if(ja)fa.setFile(ja);ga(fa);},this.$ChatAutoSendPhotoUploaderg.bind(this,fa));};ea.prototype.$ChatAutoSendPhotoUploader7=function(){var fa=aa();this.$ChatAutoSendPhotoUploaderh(fa,this.$ChatAutoSendPhotoUploader1.files);};ea.prototype.$ChatAutoSendPhotoUploaderh=function(fa,ga){var ha={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ga&&ga.length===1){this.$ChatAutoSendPhotoUploader3[fa]=fa;ha[fa]=ga[0];var ia=new FileReader();ia.onload=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploaderd(fa,v(ia.result))]});}.bind(this);ia.onerror=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploadere(fa)]});}.bind(this);ia.readAsArrayBuffer(ga[0]);}else{var ja=[];if(!ga){this.$ChatAutoSendPhotoUploader3[fa]=fa;this.$ChatAutoSendPhotoUploader0.value=fa;ja.push(this.$ChatAutoSendPhotoUploadere(fa));}else for(var ka=0;ka<ga.length;++ka){var la=aa();ha[la]=ga[ka];this.$ChatAutoSendPhotoUploader3[la]=fa;ja.push(this.$ChatAutoSendPhotoUploadere(la));}this.inform('submit',{upload_id:fa,preview_attachments:ja});}if(Object.keys(ha).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(ha);};ea.prototype.$ChatAutoSendPhotoUploader8=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);if(this.$ChatAutoSendPhotoUploader3[ga]){var ha=this.$ChatAutoSendPhotoUploader3[ga];delete this.$ChatAutoSendPhotoUploader3[ga];var ia=fa.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ha])this.$ChatAutoSendPhotoUploader4[ha]=[];this.$ChatAutoSendPhotoUploader4[ha].push({id:ga,fbid:ia.metadata[0].image_id});this.inform('success',{upload_id:ga});if(!this.$ChatAutoSendPhotoUploaderj(ha))this.$ChatAutoSendPhotoUploaderk(ha);}};ea.prototype.$ChatAutoSendPhotoUploaderk=function(fa){x(!this.$ChatAutoSendPhotoUploaderj(fa));this.$ChatAutoSendPhotoUploader4[fa].sort(function(ha,ia){return ha.id<ia.id?-1:1;});var ga=this.$ChatAutoSendPhotoUploader4[fa].map(function(ha){return ha.fbid;});this.inform('all-uploads-completed',{upload_id:fa,image_ids:ga});delete this.$ChatAutoSendPhotoUploader4[fa];};ea.prototype.$ChatAutoSendPhotoUploadera=function(event,fa){this.inform('progress',{upload_id:fa.upload.getName(),event:fa.event});};ea.prototype.$ChatAutoSendPhotoUploaderg=function(fa,event){this.inform('resize_progress',{upload_id:fa.getName(),event:event});};ea.prototype.$ChatAutoSendPhotoUploaderj=function(fa){return t(w(this.$ChatAutoSendPhotoUploader3),fa);};ea.prototype.$ChatAutoSendPhotoUploader9=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);this.$ChatAutoSendPhotoUploaderl(ga,'last-upload-failed');return false;};ea.prototype.$ChatAutoSendPhotoUploaderf=function(fa){this.$ChatAutoSendPhotoUploaderl(fa,'last-upload-canceled');};ea.prototype.$ChatAutoSendPhotoUploaderl=function(fa,ga){if(!this.$ChatAutoSendPhotoUploader3[fa])return;var ha=this.$ChatAutoSendPhotoUploader3[fa];delete this.$ChatAutoSendPhotoUploader3[fa];if(!this.$ChatAutoSendPhotoUploaderj(ha))if(this.$ChatAutoSendPhotoUploader4[ha]){this.$ChatAutoSendPhotoUploaderk(ha);}else this.inform(ga,{upload_id:ha});};ea.prototype.$ChatAutoSendPhotoUploaderi=function(fa){if(fa.upload){return fa.upload.getName();}else return fa.response.getPayload().uploadID;};ea.prototype.uploadFile=function(fa){var ga=aa(),ha={};ha[ga]=fa;var ia=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setFiles(ha);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ia.subscribe('success',function(event,ja){this.$ChatAutoSendPhotoUploader8(event,{upload:ja,response:ja.getResponse()});}.bind(this)),ia.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)));ia.send();this.$ChatAutoSendPhotoUploaderh(ga,[fa]);};e.exports=ea;},null);
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=l.createClass({displayName:"ChatPhotoUploader",propTypes:{actionURI:l.PropTypes.string,onSubmit:l.PropTypes.func,onAllUploadsComplete:l.PropTypes.func,onLastUploadFail:l.PropTypes.func,onLastUploadCancel:l.PropTypes.func},getDefaultProps:function(){return {actionURI:k.upload_url,onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(s,t){return s.actionURI!=this.props.actionURI;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (l.createElement("form",{action:this.props.actionURI,method:"post",ref:"form"},l.createElement("input",{type:"hidden",name:"attach_id",ref:"attachID"}),l.createElement("input",{type:"hidden",name:"images_only",value:true}),l.createElement(i,{className:"_m _4q60 _3rzn"},l.createElement(j,{className:"_4q61 _509v"},l.createElement(h,{className:"_509w",src:q('/images/chat/chat_camera_icon.png'),alt:"\u0e01\u0e25\u0e49\u0e2d\u0e07"})),l.createElement("input",{type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:"image/*",ref:"input"}))));},_handleSubmit:function(s,t){this.props.onSubmit(s,t);},_handleAllUploadsCompleted:function(s,t){this.props.onAllUploadsComplete(s,t);},_handleLastUploadFailed:function(s,t){this.props.onLastUploadFail(s,t);},_handleLastUploadCanceled:function(s,t){this.props.onLastUploadCancel(s,t);},isUploading:function(){return this._uploader&&this._uploader.isUploading();},uploadFile:function(s){this._uploader.uploadFile(s);}});e.exports=r;},null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){this._subscribeToken&&i.unsubscribe(this._subscribeToken);}});e.exports=k;},null);
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s,t){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=t;m.listen(r,'keyup',function(){var u=t?t():r.value;!u.length&&this.$ChatShareLinkUploader6.enable();}.bind(this));this.$ChatShareLinkUploader6=new j(r,t);this.$ChatShareLinkUploader6.subscribe('match',function(u,v){this.loadShare(v&&v.url);}.bind(this));this.$ChatShareLinkUploader7=1337;this.$ChatShareLinkUploader8=null;}p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1,this.$ChatShareLinkUploader5);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploader9();this.$ChatShareLinkUploader6.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploader9();this.$ChatShareLinkUploader6.enable();};p.prototype.$ChatShareLinkUploader9=function(){"use strict";var q=this.$ChatShareLinkUploader8;delete this.$ChatShareLinkUploader8;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploadera();this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader6&&this.$ChatShareLinkUploader6.reset();};p.prototype.loadShareFromParams=function(q,r){"use strict";this.$ChatShareLinkUploaderb(new g().setMethod('POST').setURI('/ajax/share_params.php').setData({chat:true,share_type:q,share_params:r}));};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploaderb(new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData({chat:true,extra_params:JSON.stringify(r),u:q}));};p.prototype.$ChatShareLinkUploadera=function(){"use strict";return (++this.$ChatShareLinkUploader7);};p.prototype.$ChatShareLinkUploaderc=function(){"use strict";return this.$ChatShareLinkUploader7;};p.prototype.$ChatShareLinkUploaderb=function(q){"use strict";this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();var r=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader8)i.remove(this.$ChatShareLinkUploader8);this.$ChatShareLinkUploader8=r.getRoot();m.listen(r.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader8);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');this.$ChatShareLinkUploader4=q.setHandler(this.$ChatShareLinkUploaderd.bind(this,this.$ChatShareLinkUploadera()));this.$ChatShareLinkUploader4.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploaderd=function(q,r){"use strict";if(this.$ChatShareLinkUploaderc()!==q)return;this.$ChatShareLinkUploader4=null;i.appendContent(this.$ChatShareLinkUploader8,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();return;}h.addClass(this.$ChatShareLinkUploader8,'done');};e.exports=p;},null);
__d("MercurySharePreview.react",["AsyncRequest","Image.react","ImageBlock.react","LeftRight.react","LoadingIndicator.react","React","XUICloseButton.react","cx","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=l.createClass({displayName:"MercurySharePreview",propTypes:{imageSize:l.PropTypes.shape({width:l.PropTypes.number.isRequired,height:l.PropTypes.number.isRequired}).isRequired,share:l.PropTypes.shape({params:l.PropTypes.array,type:l.PropTypes.number}),uri:l.PropTypes.string,onClose:l.PropTypes.func,onUpdate:l.PropTypes.func},getInitialState:function(){return {attachmentData:null,loading:false};},componentWillMount:function(){this._requestID=1337;this._currentRequest=null;},componentWillUnmount:function(){this._reset();},componentWillReceiveProps:function(r){o(!(r.share&&r.uri));if(!r.share&&!r.uri)return this._reset();var s=this.state.attachmentData||this.state.loading;if(r.share&&!s){this._loadFromShare(r.share);}else if(r.uri&&!(s&&this.props.uri==r.uri))this._loadFromURI(r.uri);},componentDidUpdate:function(r,s){this.props.onUpdate&&this.props.onUpdate(this);},getShareID:function(){return this.state.attachmentData&&this.state.attachmentData.share_id;},isLoading:function(){return this.state.loading;},_loadFromShare:function(r){this._currentRequest=new g().setURI('/message_share_attachment/fromParams/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,share_params:r.params,share_type:r.type}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_loadFromURI:function(r){this._currentRequest=new g().setURI('/message_share_attachment/fromURI/').setData({image_height:this.props.imageSize.height,image_width:this.props.imageSize.width,uri:r}).setHandler(this._onShareLoaded.bind(this,this._getNextRequestID()));this._currentRequest.send();this.setState({loading:true,attachmentData:null});},_getNextRequestID:function(){return (++this._requestID);},_getCurrentRequestID:function(){return this._requestID;},_onShareLoaded:function(r,s){if(this._getCurrentRequestID()!==r)return;this.setState({loading:false,attachmentData:s.payload});},_close:function(){this._reset();this.props.onClose&&this.props.onClose();},_reset:function(){this._getNextRequestID();this._currentRequest&&this._currentRequest.abort();this._currentRequest=null;this.setState({loading:false,attachmentData:null});},render:function(){var r=(("_4zwk")+(!(this.state.attachmentData&&this.state.attachmentData.media.image)?' '+"_4zwl":''));if(this.state.loading)return (l.createElement(j,{direction:j.DIRECTION.right,className:p(this.props.className,r)},l.createElement(k,{className:"_4zwm",size:"large",color:"white"}),l.createElement(m,{className:"_4zwn",shade:"dark",size:"small",onClick:this._close})));var s=this.state.attachmentData;if(!s)return l.createElement("div",null);if(s.media&&s.media.image)return (l.createElement(i,{className:p(this.props.className,r)},l.createElement(h,{src:s.media.image}),l.createElement("div",null,l.createElement("div",{className:"_4zwo"},s.title),l.createElement("div",{className:"_4zwp"},s.description),l.createElement("div",{className:"_4zwq"},s.source)),l.createElement(m,{className:"_4zwn",shade:"dark",size:"small",onClick:this._close})));return (l.createElement(j,{direction:j.DIRECTION.right,className:p(this.props.className,r)},l.createElement("div",null,l.createElement("div",{className:"_4zwo"},s.title),l.createElement("div",{className:"_4zwp"},s.description),l.createElement("div",{className:"_4zwq"},s.source)),l.createElement(m,{className:"_4zwn",shade:"dark",size:"small",onClick:this._close})));}});e.exports=q;},null);
__d("StickerContextualDialog.react",["ReactAbstractContextualDialog","ReactLayer","cx"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=47,k=h.createClass(g.createSpec({displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:j,length:16}}}));k.WIDTH={NORMAL:312,WIDE:400};e.exports=k;},null);
__d("ChatStickerButton.react",["BanzaiODS","React","ReactLayeredComponentMixin","StickerContextualDialog.react","StickersFlyout.react","StickerState","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p=278,q=h.createClass({displayName:"ChatStickerButton",propTypes:{onStickerSelect:h.PropTypes.func,onEmoticonSelect:h.PropTypes.func,onFlyoutShown:h.PropTypes.func,onFlyoutHidden:h.PropTypes.func,packID:h.PropTypes.string},getInitialState:function(){return {shown:false};},mixins:[i],getDefaultProps:function(){return {onStickerSelect:n,onEmoticonSelect:n};},componentDidMount:function(){g.bumpEntityKey('chat.web','sticker_button.mounted');this._subscription=l.addListener(l.PACK_SELECTED,function(r){return this.setProps({packID:r});}.bind(this));},shouldComponentUpdate:function(r,s){return (r.packID!=this.props.packID||s.shown!=this.state.shown);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (h.createElement("a",{className:"_4vuh",onClick:this.showFlyout,onMouseDown:this._prepareForClick,title:"Choose a sticker or emoticon",ref:"link"},h.createElement("div",{className:(("_4vui")+(this.state.shown?' '+"open":''))})));},renderLayers:function(){return {contextualDialog:h.createElement(j,{alignment:"left",className:"_5e-r",contextRef:"link",onBlur:this._hideFlyout,position:"above",shown:this.state.shown,width:p},h.createElement("div",null,h.createElement(k,{onShown:function(r){return this.props.onFlyoutShown&&this.props.onFlyoutShown(r);}.bind(this),onHidden:function(){return this.props.onFlyoutHidden&&this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.props.packID,shown:this.state.shown})))};},_prepareForClick:function(){this._clickGuard=this.state.shown;},showFlyout:function(){!this._clickGuard&&this.setState({shown:true});},_hideFlyout:function(){this.setState({shown:false});},_handleStickerSelected:function(r){this.props.onStickerSelect(r);},_handleEmoticonSelected:function(r){this._hideFlyout();this.props.onEmoticonSelect(r);}});e.exports=q;},null);
__d("StickersFlyoutTriggerSelector.react",["React","Sticker.react","StickerUtils","XUIContextualDialog.react","XUICloseButton.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=84,n=g.createClass({displayName:"StickersFlyoutTriggerSelector",getDefaultProps:function(){return {stickers:[]};},propTypes:{context:g.PropTypes.object.isRequired,stickers:g.PropTypes.array,onStickerSelect:g.PropTypes.func.isRequired},shouldComponentUpdate:function(o){if(this.props.stickers.length!==o.stickers.length)return true;for(var p=0;p<Math.min(this.props.stickers.length,5);p++)if(this.props.stickers[p].id!==o.stickers[p].id)return true;return false;},_renderStickers:function(){if(!this.props.stickers||this.props.stickers.length===0)return null;var o=Math.floor(Math.random()*Math.min(this.props.stickers.length,5)),p=this.props.stickers[o],q=i.getScaledDimensions(p.height,p.width);return (g.createElement("div",null,g.createElement(k,{size:"small",className:"_2ohj",onClick:this.props.onDismissTrigger}),g.createElement("div",{className:"_5r8h _onc","data-id":p.id,onClick:function(){return this.props.onStickerSelect(p.id);}.bind(this)},g.createElement(h,{animationTrigger:"hover",className:"_5r8i",frameCount:p.frameCount,frameRate:p.frameRate||83,framesPerCol:p.framesPerCol,framesPerRow:p.framesPerRow,sourceHeight:q.height,sourceURI:p.sourceURI,sourceWidth:q.width,spriteURI:p.spriteURI,paddedSpriteURI:p.paddedSpriteURI,stickerID:p.id,style:{cursor:'pointer',height:'64px'}}))));},render:function(){return (g.createElement(j,{alignment:"left",autoFocus:false,context:this.props.context,onBlur:this._resetFlyout,offsetY:11,position:"above",shown:this.props.stickers&&this.props.stickers.length>0,width:m},this._renderStickers()));}});e.exports=n;},null);
__d("StickerTrigger",["EmoticonsList","Map","StickerConfig","StickerSearch","StickerServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l=i.StickerTriggerThreshold,m=new h(),n={findTriggerForInput:function(o,p){if(o===null){p([],null);return;}j.prepareTagsData().then(function(){return this.findTagForInput(o,function(q,r){return p(q,r);});}.bind(this));},findTagForInput:function(o,p){var q=this.findTriggeredWord(o);if(q){if(m.has(q)){p(m.get(q),q);}else k.getStickersForQuery(q,function(r){var s=r.getPayload();m.set(q,s);p(s,q);});}else p([],null);},_getRegex:function(){if(i.TriggerConfidence==='emoji_only'){return g.noncapturingRegexp;}else if(i.TriggerConfidence==='high')return (/^(?:\w+\s?){1,4}$/);return null;},findTriggeredWord:function(o){var p=j.getTagsIndex();if(!p)return null;o=o.toLowerCase();var q=o.match(this._getRegex()),r=l,s=null;for(var t=0;q!==null&&t<q.length;t++)if(p[q[t]]&&p[q[t]].sticker_count>r){r=p[q[t]].sticker_count;s=q[t];}return s;}};e.exports=n;},null);
__d("StickerTriggerIndicator.react",["React","cx"],function(a,b,c,d,e,f,g,h){'use strict';var i=g.createClass({displayName:"StickerTriggerIndicator",getDefaultProps:function(){return {stickers:[]};},propTypes:{stickers:g.PropTypes.array},shouldComponentUpdate:function(j){var k=this.props.stickers.length>0,l=j.stickers.length>0;return k!==l;},render:function(){var j=this.props.stickers&&this.props.stickers.length>0;return g.createElement("span",{className:((j?"emoticonIndicator":''))});}});e.exports=i;},null);
__d("ChatStickerTriggerController",["BanzaiLogger","React","StickerConfig","StickersFlyoutTriggerSelector.react","StickerTrigger","StickerTriggerIndicator.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';function m(n,o,p,q,r){this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerController1=null;this.$ChatStickerTriggerController2=null;this.$ChatStickerTriggerController3=r;this.$ChatStickerTriggerController4=q;this.$ChatStickerTriggerController5=null;if(i.TriggerInterface==='one_tap'){this.$ChatStickerTriggerController1=h.render(h.createElement(j,{context:p,onStickerSelect:this.$ChatStickerTriggerController6.bind(this),onDismissTrigger:this.$ChatStickerTriggerController7.bind(this)}),n);this.$ChatStickerTriggerController2=n;}else if(i.TriggerInterface==='hyperlink'){this.$ChatStickerTriggerController1=h.render(h.createElement(l,null),o);this.$ChatStickerTriggerController2=o;}}m.prototype.setInput=function(n){this.$ChatStickerTriggerController8=n;};m.prototype.activateAfterparty=function(){this.$ChatStickerTriggerController9=true;clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerControllera=setTimeout(this.$ChatStickerTriggerControllerb.bind(this),5000);};m.prototype.updateInput=function(n){if(this.$ChatStickerTriggerController9)this.$ChatStickerTriggerControllerb();this.$ChatStickerTriggerControllerc(n);};m.prototype.onFlyoutShown=function(n){if(this.$ChatStickerTriggerController0&&!this.$ChatStickerTriggerControllerd){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController3(this.$ChatStickerTriggerController0,n);this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});}else n();};m.prototype.getTriggeredWord=function(){return this.$ChatStickerTriggerController0;};m.prototype.$ChatStickerTriggerController6=function(n){this.$ChatStickerTriggerController4(n);this.$ChatStickerTriggerController7();};m.prototype.$ChatStickerTriggerController7=function(){this.$ChatStickerTriggerControllerd=true;this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});};m.prototype.$ChatStickerTriggerControllere=function(n,o){if(this.$ChatStickerTriggerController5===null||this.$ChatStickerTriggerController5&&this.$ChatStickerTriggerController5.toLowerCase().indexOf(o)===-1){this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:null});this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:[]});return;}if(o)g.log('StickersLoggerConfig',{event:'sticker_trigger_activated',numsearchresults:n.length,triggeredword:o,triggerused:false});this.$ChatStickerTriggerController0=o;this.$ChatStickerTriggerController8.isMounted()&&this.$ChatStickerTriggerController8.setProps({triggeredWord:o});if(!this.$ChatStickerTriggerControllerd)this.$ChatStickerTriggerController1.isMounted()&&this.$ChatStickerTriggerController1.setProps({stickers:n});};m.prototype.$ChatStickerTriggerControllerb=function(){clearTimeout(this.$ChatStickerTriggerControllera);this.$ChatStickerTriggerController9=false;this.$ChatStickerTriggerControllerd=false;this.$ChatStickerTriggerController0=null;this.$ChatStickerTriggerControllerc(null);};m.prototype.$ChatStickerTriggerControllerc=function(n){if(this.$ChatStickerTriggerController5!==n){this.$ChatStickerTriggerController5=n;k.findTriggerForInput(this.$ChatStickerTriggerController5,this.$ChatStickerTriggerControllere.bind(this));}};m.prototype.destroy=function(){h.unmountComponentAtNode(this.$ChatStickerTriggerController2);clearTimeout(this.$ChatStickerTriggerControllera);};e.exports=m;},null);
__d("ChatFileUploaderMixin",["SubscriptionsHandler","React"],function(a,b,c,d,e,f,g,h){var i={propTypes:{attachmentsShelf:h.PropTypes.object,onFileUploaderMounted:h.PropTypes.func,onUploadFinished:h.PropTypes.func,onUpdateAttachmentsShelf:h.PropTypes.func,onSubmit:h.PropTypes.func},setUpSubscriptionsHandler:function(j){this._uploader=j;this._subscriptions=new g();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();if(!this.props.uploaderIsFromHigherLevel)this._uploader&&this._uploader.destroy();},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},getAudioFiles:function(){return this._uploader.getAudioFiles();},getFiles:function(){return this._uploader.getFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){if(this.props.onUploadFinished)this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){if(this.props.onUpdateAttachmentsShelf)this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){if(this.props.onSubmit)this.props.onSubmit();}};e.exports=i;},null);
__d("ChatFileUploader.react",["ChatFileUploaderMixin","InlineBlock.react","MercuryConfig","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=j.createClass({displayName:"ChatFileUploader",mixins:[g],getDefaultProps:function(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function(){return false;},componentDidMount:function(){var n=this.props.initFileUploaderFn(this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this.setUpSubscriptionsHandler(n);},render:function(){return (j.createElement("form",{ref:"form",action:i.upload_url,method:"post"},j.createElement("input",{type:"hidden",ref:"attachID",name:"attach_id"}),j.createElement(h,{className:"_m _4q60 itemLabel"},j.createElement("input",{type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),j.createElement("span",{className:"_4q61 itemAnchor"},"\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e44\u0e1f\u0e25\u0e4c..."))));}});e.exports=m;},null);
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","ChatConfig","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryThreadMuter","ReactComponentWithPureRenderMixin","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","WebMessengerThreadPermalinks","cx","fbt","goURI","MercuryThreadActions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){'use strict';var y=b('MercuryThreadActions').get(),z=q.Item,aa=o.createClass({displayName:"ChatTabMenu",mixins:[n],propTypes:{onFileUploaderMounted:o.PropTypes.func,updatePrivacyLinkFunc:o.PropTypes.func,nameConversationFunc:o.PropTypes.func,leaveConversationFunc:o.PropTypes.func,showParticipantsFunc:o.PropTypes.func,clearHistoryFunc:o.PropTypes.func,reportSpamFunc:o.PropTypes.func,createGroupFunc:o.PropTypes.func,switchToWorkFunc:o.PropTypes.func,isMultichat:o.PropTypes.bool,isEmptyChat:o.PropTypes.bool,hasSwitchToWork:o.PropTypes.bool,showAddFriend:o.PropTypes.func,threadID:o.PropTypes.string,attachmentsShelf:o.PropTypes.object,onUploadFinished:o.PropTypes.func,onUpdateAttachmentsShelf:o.PropTypes.func,onSubmit:o.PropTypes.func,enableDesktopNotif:o.PropTypes.func},getInitialState:function(){return {url:null};},getDefaultProps:function(){return {show:true};},componentDidMount:function(){u.getThreadURI(this.props.threadID,function(ba){this.isMounted()&&this.setState({url:ba});}.bind(this));if(!this.props.isMultiChat)this._privacyActionController=new h(k.getUserIDFromThreadID(this.props.threadID),this.props.updatePrivacyLinkFunc);},_initFileUploader:function(ba,ca,da){if(this._fileUploader){this._fileUploader.updateElements(ba,ca,da);}else this._fileUploader=new l(this.props.attachmentsShelf,ba,ca,da);return this._fileUploader;},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploader&&this._fileUploader.destroy();},_unmuteThread:function(){y.unmute(this.props.threadID);s.hide();},_togglePrivacyFunc:function(){this._privacyActionController.togglePrivacy();},getURL:function(){return this.state.url;},_renderFileUploader:function(){return (o.createElement(z,{className:"_37_x"},o.createElement(g,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.state.url)return (o.createElement(z,{onclick:function(){return x(this.state.url);}.bind(this)},"\u0e14\u0e39\u0e1a\u0e17\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14"));return null;},_renderAddFriend:function(){if(!this.props.showAddFriend)return null;return (o.createElement(z,{onclick:this.props.showAddFriend},"\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32..."));},_renderTogglePrivacy:function(){if(!this.props.isMultichat)return (o.createElement(z,{onclick:this._togglePrivacyFunc},this.props.privacyText));return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var ba=m.showMuteChangeDialog.bind(null,this.props.threadID);return (o.createElement(z,{onclick:ba},"\u0e1b\u0e34\u0e14\u0e40\u0e2a\u0e35\u0e22\u0e07\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32..."));}else return (o.createElement(z,{onclick:this._unmuteThread},"\u0e40\u0e1b\u0e34\u0e14\u0e40\u0e2a\u0e35\u0e22\u0e07\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"));},_renderClearConversation:function(){if(!this.props.isMultichat)return (o.createElement(z,{onclick:this.props.clearHistoryFunc},"\u0e25\u0e49\u0e32\u0e07\u0e2b\u0e19\u0e49\u0e32\u0e15\u0e48\u0e32\u0e07"));return null;},_renderReportSpam:function(){if(!this.props.isMultichat)return (o.createElement(z,{onclick:this.props.reportSpamFunc},"\u0e23\u0e32\u0e22\u0e07\u0e32\u0e19\u0e27\u0e48\u0e32\u0e40\u0e1b\u0e47\u0e19\u0e2a\u0e41\u0e1b\u0e21\u0e2b\u0e23\u0e37\u0e2d\u0e01\u0e32\u0e23\u0e43\u0e0a\u0e49\u0e43\u0e19\u0e17\u0e32\u0e07\u0e17\u0e35\u0e48\u0e1c\u0e34\u0e14"));return null;},_renderCreateGroup:function(){if(this.props.isMultichat)return (o.createElement(z,{onclick:this.props.createGroupFunc},"\u0e2a\u0e23\u0e49\u0e32\u0e07\u0e01\u0e25\u0e38\u0e48\u0e21"));return null;},_renderSwitchToWork:function(){if(this.props.isMultichat&&i.get('has_switch_to_work')&&this.props.hasSwitchToWork)return (o.createElement(z,{onclick:this.props.switchToWorkFunc},"Move to Work Account"));},_renderConversationName:function(){if(this.props.isMultichat&&this.state.url)return (o.createElement(z,{onclick:this.props.nameConversationFunc},"\u0e41\u0e01\u0e49\u0e44\u0e02\u0e0a\u0e37\u0e48\u0e2d\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (o.createElement(z,{onclick:this.props.leaveConversationFunc},"\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32..."));return null;},_renderEnableDesktopNotifications:function(){if(j.DesktopNotificationsGK&&"Notification" in window&&Notification.permission!=="granted")return (o.createElement(z,{onclick:this.props.enableDesktopNotif},"Enable Desktop Notifications"));return null;},_renderPeopleList:function(){if(this.props.isMultichat&&this.state.url)return (o.createElement(z,{onclick:this.props.showParticipantsFunc},"\u0e41\u0e01\u0e49\u0e44\u0e02\u0e1c\u0e39\u0e49\u0e21\u0e35\u0e2a\u0e48\u0e27\u0e19\u0e23\u0e48\u0e27\u0e21..."));return null;},render:function(){var ba=this._renderReportSpam(),ca=this._renderCreateGroup(),da=o.createElement(q,{className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),o.createElement(r,null),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderClearConversation(),this._renderLeaveConversation(),ba?(o.createElement(r,null)):null,ba,ca?(o.createElement(r,null)):null,ca,this._renderEnableDesktopNotifications()),ea="\u0e15\u0e31\u0e27\u0e40\u0e25\u0e37\u0e2d\u0e01",fa=t.getTrackingInfo(t.types.DROPDOWN_BUTTON);return (o.createElement(p,{menu:da},o.createElement("a",{"data-ft":fa,"data-hover":"tooltip","aria-label":ea,"data-tooltip-alignh":"center",className:(("button")+(this.props.isEmptyChat?' '+"hidden_elem":''))})));}});e.exports=aa;},null);
__d("ChatDateBreak.react",["React","ReactPropTypes","Timestamp.react","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g.createClass({displayName:"ChatDateBreak",propTypes:{date:h.instanceOf(Date).isRequired},shouldComponentUpdate:function(n){return this.props.date.getTime()!==n.date.getTime();},render:function(){var n=this.props.date,o=k(n,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),p=Math.round(n.getTime()/1000);return (g.createElement("div",g.__spread({},this.props,{className:l(this.props.className,"_5w-5")}),g.createElement("div",{className:"_5w-6"},g.createElement(i,{time:p,verbose:o,text:o}))));}});e.exports=m;},null);
__d("ChatAuthorPhotoBlock.react",["MercuryParticipants","ReactPropTypes","React","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=86400000,n=i.createClass({displayName:"ChatAuthorPhotoBlock",propTypes:{authorID:h.string.isRequired,hideName:h.bool,hidePhoto:h.bool,timestamp:h.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.updateAuthor(this.props.authorID);},componentWillReceiveProps:function(o){if(o.authorID!=this.state.author.id)this.updateAuthor(o.authorID);},render:function(){return (i.createElement("div",i.__spread({},this.props,{className:l(this.props.className,"_5yt9")}),this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (i.createElement("div",{className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto){var o=null;if(this.props.timestamp){var p=(Date.now()-this.props.timestamp>m)?'M jS, g:ia':'g:ia';o=k(new Date(this.props.timestamp),p);}return (i.createElement("a",{"aria-label":o,className:"_5ys_","data-hover":"tooltip","data-tooltip-position":"left",href:this.state.author.href,ref:"link"},i.createElement("img",{src:this.state.author.image_src,ref:"image"})));}},updateAuthor:function(o){g.get(o,function(p){this.isMounted()&&this.setState({author:p});}.bind(this));}});e.exports=n;},null);
__d("MessageBubbleMixin",["DOMDimensions"],function(a,b,c,d,e,f,g){'use strict';var h={getInitialState:function(){return {bubbleWidth:this.props.maxWidth};},componentDidMount:function(){this.shrinkBubble();},componentWillReceiveProps:function(i){if(i.body!=this.props.body)this.setState({bubbleWidth:this.props.maxWidth});},componentDidUpdate:function(i,j){if(i.body!=this.props.body)this.shrinkBubble();},shrinkBubble:function(){var i=this.refs.bubble.getDOMNode(),j=this.refs.content.getDOMNode(),k=g.getElementDimensions(i).width,l=j?g.getElementDimensions(j).width:0;if(l>0&&this.contentWraps()&&l<this.props.maxWidth&&k-l-this.getBoxWidth()>0&&l!=this.state.bubbleWidth)this.setState({bubbleWidth:l});},contentWraps:function(){var i=this.refs.content.getDOMNode(),j=i.getClientRects(),k=g.getElementDimensions(i).height;return (j&&j.length>1&&j[0].height<k);}};e.exports=h;},null);
__d("ChatBubble.react",["DOMDimensions","MercuryMessageBody.react","MessageBubbleMixin","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m=null,n=j.createClass({displayName:"ChatBubble",mixins:[i],propTypes:{attachments:j.PropTypes.node,body:j.PropTypes.string,maxWidth:j.PropTypes.number.isRequired},render:function(){return (j.createElement("div",j.__spread({},this.props,{className:l(this.props.className,"_5w1r"),ref:"bubble",style:Object.assign({},(this.props.style||{}),{maxWidth:this.state.bubbleWidth})}),j.createElement("div",null,j.createElement("span",{className:"_5yl5",ref:"content"},j.createElement(h,{body:this.props.body,ranges:this.props.ranges}))),this.props.attachments));},getBoxWidth:function(){if(!m)m=g.measureElementBox(this.refs.bubble.getDOMNode(),'width',true,true,false);return m;}});e.exports=n;},null);
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","DOM","Event","ImmutableObject","React","SubscriptionsHandler","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p=176,q=4,r=k.createClass({displayName:"MercuryAttachments",propTypes:{message:k.PropTypes.instanceOf(j).isRequired,attachments:k.PropTypes.array.isRequired,isChat:k.PropTypes.bool,onImageLoad:k.PropTypes.func,onStickerClick:k.PropTypes.func},getDefaultProps:function(){return {isChat:false,onImageLoad:n,onStickerClick:n};},componentDidMount:function(){this._subscriptionsHandler=new l();this.renderAttachments();},componentDidUpdate:function(){this.renderAttachments();},componentWillUnmount:function(){this._subscriptionsHandler.release();},render:function(){var s=this.props.attachments.filter(g.isPhotoAttachment).length>0;return (k.createElement("div",k.__spread({},this.props,{className:o(this.props.className,(("_5h9y")+(s?' '+"_zl6":'')))})));},renderAttachments:function(){var s=this.getDOMNode();h.empty(s);var t=this.props.message,u=g.sortAttachmentsStablyByType(this.props.attachments),v=g.renderPhotoAttachments(u.filter(g.isPhotoAttachment),t,p,q);v&&h.appendContent(s,v);for(var w=0;w<u.length;w++){var x=u[w];if(g.isPhotoAttachment(x))continue;var y=g.renderAttachment(this.props.isChat,x,t,null,null,this.props.onStickerClick);y.error&&h.appendContent(s,y.error);y.content&&h.appendContent(s,y.content);}h.scry(s,'img').forEach(function(z){this._subscriptionsHandler.addSubscriptions(i.listen(z,'load',function(){this.props.onImageLoad(z);}.bind(this)));}.bind(this));}});e.exports=r;},null);
__d("MercurySpoofWarning.react",["MercuryParticipants","ReactPropTypes","React","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k=i.createClass({displayName:"MercurySpoofWarning",propTypes:{authorID:h.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(l){g.get(l.authorID,function(m){return this.setState({author:m});}.bind(this));},render:function(){return (i.createElement("div",i.__spread({},this.props),j._("Unable to confirm {name_or_email} as the sender.",[j.param("name_or_email",this.state.author.name)])));}});e.exports=k;},null);
__d("ChatMessage.react",["ChatAnimatedGifs","ChatAuthorPhotoBlock.react","ChatBubble.react","ChatConfig","CSS","ImmutableObject","MercuryAttachment","MercuryAttachments.react","MercuryAttachmentRenderer","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercurySpoofWarning.react","React","ReactPropTypes","cx","fbt","formatDate","isRTL","joinClasses","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';var aa=b('MercuryMessages').get(),ba=t.createClass({displayName:"ChatMessage",propTypes:{message:u.instanceOf(l).isRequired,maxBubbleWidth:u.number.isRequired,onImageLoad:u.func,onStickerClick:u.func},componentDidMount:function(){k.conditionClass(this.getDOMNode(),"_2cnu",this.isOneLine());},isOneLine:function(){var ca=this.props.message;return aa.isInbound(ca)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps();},shouldComponentUpdate:function(ca,da){return ca.message!==this.props.message;},render:function(){var ca=this.props.message,da=aa.isInbound(ca),ea=q.isMultichat(ca.thread_id),fa=y(ca.body),ga=j.get('chat_fading_bubbles')&&!da&&aa.isSending(ca),ha=p.hasErrorStatus(ca),ia=(("_5wd4")+(da?' '+"_1nc7":'')+(!da?' '+"_1nc6":'')+(da&&ea?' '+"_5ysy":'')+(ga?' '+"_4oe5":'')+(ha?' '+"_1zcs":'')+(fa?' '+"direction_rtl":'')+(!fa?' '+"direction_ltr":'')),ja=new Date(ca.timestamp);return (t.createElement(h,t.__spread({},this.props,{authorID:ca.author,className:z(this.props.className,ia),hideName:!da||!ea,hidePhoto:!da,timestamp:ca.timestamp,title:da?null:x(ja,'g:ia')}),this._renderInner(),this._renderUndertext()));},_renderInner:function(){if(this.props.message.is_filtered_content)return (t.createElement("div",{className:"_5wd9",ref:"inner"},this._renderFilteredContent()));return (t.createElement("div",{className:"_5wd9",ref:"inner"},this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (t.createElement("div",{className:"_3ry4",ref:"undertext"},t.createElement(r,{className:"_5wda clearfix",message:this.props.message,ref:"status"}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?t.createElement(s,{authorID:this.props.message.author,className:"_5wdb"}):null);},_renderFilteredContent:function(){return t.createElement("div",{className:"_5wdc uiBoxYellow clearfix"},"This message is no longer available because it was identified as abusive or marked as spam.");},_renderAttachments:function(ca){var da=this.props.message,ea=ca=='inside'?'attachmentsInside':'attachmentsOutside',fa=m.get(da).filter(function(ga){var ha=o.isBubblePreferred(ga);return (ha&&ca==='inside')||(!ha&&ca==='outside');});if(fa.length>0)return t.createElement(n,{className:"_5wdd clearfix",isChat:true,message:da,attachments:fa,ref:ea,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick});},_renderBubble:function(){var ca=this.props.message,da=ca.body,ea=this._renderAttachments('inside');if(g.shouldHideBody(ca))da='';if(da||ea)return (t.createElement("div",{className:"_5wde"},t.createElement(i,{attachments:ea,body:da,className:"_5wdf",maxWidth:this.props.maxBubbleWidth,ranges:ca.ranges,ref:"bubble"})));}});e.exports=ba;},null);
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryViewer","PresencePrivacy","React","ReactPropTypes","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:"ChatVideoCallLink",propTypes:{message:l.object.isRequired,onClick:l.func.isRequired},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.createElement("a",{className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),"data-gt":JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return ("\u0e25\u0e2d\u0e07\u0e15\u0e31\u0e49\u0e07\u0e04\u0e48\u0e32\u0e41\u0e25\u0e49\u0e27\u0e42\u0e17\u0e23\u0e01\u0e25\u0e31\u0e1a\u0e21\u0e32\u0e43\u0e2b\u0e21\u0e48");}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)return ("\u0e42\u0e17\u0e23\u0e01\u0e25\u0e31\u0e1a");},shouldHideLink:function(){return !h.isOnline()||!n.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var r;if(this.props.message.log_message_data.event_name=='install_canceled'){r='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.getID()&&!this.props.message.log_message_data.answered)r='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,r);},availabilityChanged:function(){this.forceUpdate();}});e.exports=q;},null);
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","ReactPropTypes","VideoCallSupport","cx","emptyFunction","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';var t=m.createClass({displayName:"MercuryLogMessage",propTypes:{message:n.instanceOf(j).isRequired,onImageLoad:n.func,onVideoCallLinkClick:n.func},getDefaultProps:function(){return {onImageLoad:q};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(u){k.renderText(u.message,function(v){this.setState({messageText:v});}.bind(this));},shouldComponentUpdate:function(u,v){return this.state.messageText!=v.messageText;},componentDidUpdate:function(){var u=this.refs.attachment.getDOMNode();k.renderAttachmentLegacy(u,this.props.message);g.scry(u,'img').forEach(function(v){var w=h.listen(v,'load',function(){this.props.onImageLoad(v);w.remove();}.bind(this));}.bind(this));},render:function(){return (m.createElement("div",m.__spread({},this.props,{className:s(this.props.className,"_5ye6"),title:r(new Date(this.props.message.timestamp),'g:ia')}),k.renderIcon(this.props.message),m.createElement("div",{className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.createElement("div",{className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!o.isVideoCallSupported())return null;return (m.createElement(i,{message:this.props.message,onClick:this.props.onVideoCallLinkClick}));}});e.exports=t;},null);
__d("ChatConversation.react",["ChatDateBreak.react","ChatMessage.react","ImmutableObject","MercuryActionTypeConstants","MercuryLogMessage.react","React","cx","invariant","OrionNUXRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=b('OrionNUXRenderer').module,p=1000*60*60,q=l.createClass({displayName:"ChatConversation",propTypes:{maxBubbleWidth:l.PropTypes.number.isRequired,messages:l.PropTypes.arrayOf(l.PropTypes.instanceOf(i)).isRequired,onCallLinkClick:l.PropTypes.func,onImageLoad:l.PropTypes.func,onStickerClick:l.PropTypes.func},componentWillReceiveProps:function(r){n(r.maxBubbleWidth===this.props.maxBubbleWidth);},render:function(){var r=this.props.messages,s=[];for(var t=0;t<r.length;t++){var u=r[t],v=(t>0)?r[t-1]:null;if(u.is_cleared)continue;if(!v||v.is_cleared||u.timestamp-v.timestamp>p)s.push(l.createElement(g,{date:new Date(u.timestamp),key:'db:'+u.message_id}));if(u.action_type==j.LOG_MESSAGE){s.push(l.createElement(k,{className:"_5w0o",key:u.message_id,message:u,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else{s.push(l.createElement(h,{key:u.message_id,message:u,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));if(o&&o.isValidNUXMessage(u))s.push(l.createElement(o,{key:'onr_c:'+u.message_id,message:u,onImageLoad:this.props.onImageLoad,type:"chat"}));}}return l.createElement("div",null,s);}});e.exports=q;},null);
__d("ChatTypingIndicators.react",["ChatAuthorPhotoBlock.react","DOM","MercuryIDs","MercuryParticipants","ReactPropTypes","React","SubscriptionsHandler","Tooltip","MercuryTypingReceiver","arraySort","createObjectFrom","cx","emptyFunction","fbt","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryThreadInformer').get(),v=l.createClass({displayName:"ChatTypingIndicators",propTypes:{indicatorsWillShow:k.func,indicatorsDidShow:k.func,threadID:k.string.isRequired},getDefaultProps:function(){return {indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(o.addRetroactiveListener('state-changed',this.typingStateChanged),u.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();j.getMulti(this.state.typingUserIDs,function(w){if(this.isMounted())this.state.typingUserIDs.forEach(function(x){var y=w[x];n.set(this.refs[x].getDOMNode(),this.renderTooltip(y.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=i.isMultichat(this.props.threadID);return (l.createElement("div",{className:"_2fsr"},this.state.typingUserIDs.map(function(x){return l.createElement(g,{authorID:x,className:(("_gfq")+(w?' '+"_52fu":'')),hideName:!w,key:x},l.createElement("div",{className:"_52ft"},l.createElement("div",{className:"_gfp",ref:x})));})));},renderTooltip:function(w){var x=h.create('span');l.render(l.createElement("span",null,t._("{name} \u0e01\u0e33\u0e25\u0e31\u0e07\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e2d\u0e22\u0e39\u0e48...",[t.param("name",w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:p(w[this.props.threadID])});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=q(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:p(this.state.typingUserIDs.filter(function(aa){return !z[aa];}))});}}});e.exports=v;},null);
__d("MercuryTypingAnimation.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=g.createClass({displayName:"MercuryTypingAnimation",propTypes:{color:g.PropTypes.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var k=(("_4a0v")+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":''));return (g.createElement("div",{className:i(this.props.className,k)},g.createElement("div",{className:"_4b0g"},g.createElement("div",{className:"_4a0y"}),g.createElement("div",{className:"_4a0y"}),g.createElement("div",{className:"_4a0y"}))));}});e.exports=j;},null);
__d("MercuryTypingIndicator",["Animation","ChatConfig","CSS","DOM","MercuryTypingAnimation.react","MercuryTypingReceiver","MercuryViewer","MercuryParticipants","React","Style","ChatTabTemplates","Tooltip","copyProperties","csx","cx","fbt","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=b('MercuryThreadInformer').get(),x=[];w.subscribe('messages-received',function(aa,ba){x.forEach(function(ca){var da=ba[ca._threadID];da&&ca.receivedMessages(da);});});l.addRetroactiveListener('state-changed',function(aa){x.forEach(function(ba){var ca=aa[ba._threadID];ca&&ba._handleStateChanged(ca);});});function y(aa){var ba=q[':fb:chat:conversation:message-group'].build(),ca=q[':fb:mercury:typing-indicator:typing'].build();i.addClass(ba.getRoot(),"_50kd");var da=ba.getNode('profileLink');r.set(da,aa.name,'left');da.href=aa.href;ba.setNodeContent('profileName',aa.name);ba.setNodeProperty('profilePhoto','src',aa.image_src);var ea=v._("{name} \u0e01\u0e33\u0e25\u0e31\u0e07\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e2d\u0e22\u0e39\u0e48...",[v.param("name",aa.short_name)]);r.set(ca.getRoot(),ea,'above');j.appendContent(ba.getNode('messages'),ca.getRoot());return ba;}function z(aa,ba,ca){this._animations={};this._activeUsers={};this._typingIndicator=ba;this._messagesView=ca;this._threadID=aa;this._subscription=l.addRetroactiveListener('state-changed',function(da){var ea=da[this._threadID];ea&&this._handleStateChanged(ea);}.bind(this));x.push(this);}s(z.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();x.remove(this);},receivedMessages:function(aa){aa.forEach(function(ba){if(!m.isViewer(ba.author))this._removeUserBubble(ba.author);}.bind(this));},_handleStateChanged:function(aa){for(var ba in this._activeUsers)if(aa.indexOf(ba)===-1){this._slideOutUserBubble(ba);delete this._activeUsers[ba];}if(aa.length)n.getMulti(aa,function(ca){var da=this._messagesView.isScrolledToBottom(),ea={};for(var fa in ca){var ga=this._activeUsers[fa];ea[fa]=ga||y(ca[fa]).getRoot();if(!ga){j.appendContent(this._typingIndicator,ea[fa]);if(h.get('chat_thread_typing_indicator_animated')){var ha=j.scry(this._typingIndicator,"._510u");for(var ia=0,ja=ha.length;ia<ja;ia++)o.render(o.createElement(k,{className:"_3e2s"}),ha[ia]);}}}var ka=Object.keys(ea).length>0;da&&this._messagesView.scrollToBottom(ka);this._activeUsers=ea;}.bind(this));},_removeUserBubble:function(aa,ba){var ca=this._getCurrentAnimation(aa,ba);if(ca){ca.animation.stop();j.remove(ca.elem);delete this._animations[aa];}if(aa in this._activeUsers){j.remove(this._activeUsers[aa]);delete this._activeUsers[aa];}if(ba&&h.get('chat_thread_typing_indicator_animated')){var da=j.scry(ba,"._510u");for(var ea=0,fa=da.length;ea<fa;ea++)o.unmountComponentAtNode(da[ea]);}ba&&j.remove(ba);},_slideOutUserBubble:function(aa){var ba=this._activeUsers[aa];if(this._getCurrentAnimation(aa,ba)){return;}else if(ba){p.set(ba,'overflow','hidden');var ca=(new g(ba)).from('opacity',1).from('height',ba.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,aa,ba)).go();this._animations[aa]={animation:ca,elem:ba};}},_getCurrentAnimation:function(aa,ba){if(this._animations[aa]&&(!ba||this._animations[aa].elem===ba))return this._animations[aa];}});e.exports=z;},null);
__d("MercuryMessageList",["ImmutableObject","LogHistory","OrderedMap","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=h.getInstance('mercury_message_list');function l(q){this.$MercuryMessageList0=n(q?m(q):[]);}l.prototype.append=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q)));p('append',q);};l.prototype.prepend=function(q){this.$MercuryMessageList0=n(m(q)).merge(this.$MercuryMessageList0);p('prepend',q);};l.prototype.update=function(q){var r=q.filter(function(s){return this.contains(s);}.bind(this));if(r.length===0)return;this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(r)));p('update',q);};l.prototype.reorder=function(q){this.$MercuryMessageList0=n(q.map(function(r){var s=this.$MercuryMessageList0.get(r.message_id);if(!s||s.timestamp!=r.timestamp||s.is_cleared!=r.is_cleared)return new g(r);return s;}.bind(this)));p('reorder',q);};l.prototype.hasReachedClearedMessages=function(){var q=this.messageAt(0);return !!(q&&q.is_cleared);};l.prototype.messageAt=function(q){var r=this.$MercuryMessageList0.keyAtIndex(q);return r?this.$MercuryMessageList0.get(r):(void 0);};l.prototype.contains=function(q){return this.$MercuryMessageList0.indexOfKey(o(q))!==(void 0);};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toOrderedMap=function(){return this.$MercuryMessageList0;};function m(q){return q.map(function(r){return new g(r);});}function n(q){return i.fromArray(q,o);}function o(q){return q.message_id;}function p(event,q){j(function(){k.debug(event,{messageIDs:q.map(function(r){return r.message_id;})});},0);}e.exports=l;},null);
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryViewer","MercuryMessageList","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","merge","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q=b('MercuryMessages').get(),r=b('MercuryThreadInformer').get(),s=b('MercuryThreads').get(),t=h.getInstance('mercury_message_store');function u(w){this.$MercuryMessageStore0=w;this.$MercuryMessageStore1=new j();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=new k();this.$MercuryMessageStore5.addSubscriptions(r.subscribe('messages-received',function(x,y){return this.$MercuryMessageStore7(y);}.bind(this)),r.subscribe('messages-updated',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore8(y[this.$MercuryMessageStore0]);}.bind(this)),r.subscribe('messages-reordered',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore9();}.bind(this)));t.debug('constructed',{threadID:this.$MercuryMessageStore0});this.$MercuryMessageStorea();}u.prototype.setNewThreadID=function(w){this.$MercuryMessageStoreb=w;};u.prototype.destroy=function(){this.$MercuryMessageStore5&&this.$MercuryMessageStore5.release();t.debug('destroyed',{threadID:this.$MercuryMessageStore0});};u.prototype.subscribe=function(w){return this.addRetroactiveListener('updated',w);};u.prototype.fetchMoreMessages=function(){if(q.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&q.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(s.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;if(this.$MercuryMessageStore1.hasReachedClearedMessages())return false;return this.$MercuryMessageStorea();};u.prototype.$MercuryMessageStorea=function(){var w=this.$MercuryMessageStore4+l.RECENT_MESSAGES_LIMIT*this.$MercuryMessageStore2;t.debug('fetching',{threadID:this.$MercuryMessageStore0,limit:w});q.getThreadMessagesRange(this.$MercuryMessageStore0,0,w,this.$MercuryMessageStorec.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(q.hasLoadedNMessages(this.$MercuryMessageStore0,w)){this.$MercuryMessageStore9();return false;}return true;};u.prototype.$MercuryMessageStorec=function(w){if(w&&w.length){this.$MercuryMessageStore3=w[0].timestamp;this.$MercuryMessageStore4=w.length;t.debug('fetched',{threadID:this.$MercuryMessageStore0,earliestMessageTimestamp:this.$MercuryMessageStore3,count:this.$MercuryMessageStore4});}};u.prototype.$MercuryMessageStore7=function(w){var x=[],y=w[this.$MercuryMessageStore0];if(y&&y.length)x=x.concat(y);if(this.$MercuryMessageStoreb){var z=w[this.$MercuryMessageStoreb];if(z&&z.length){x=x.concat(z);this.$MercuryMessageStoreb=null;}}if(x.length){this.$MercuryMessageStore1.append(x);this.$MercuryMessageStore4+=x.length;var aa=x.every(function(ba){return ba.author!=i.getID();});this.$MercuryMessageStored(u.MESSAGES_RECEIVED,{allFromOthers:aa});}};u.prototype.$MercuryMessageStore8=function(w){this.$MercuryMessageStore1.update(q.getMessagesFromIDs(Object.keys(w)));this.$MercuryMessageStoree();this.$MercuryMessageStored(u.MESSAGES_CHANGED);};u.prototype.$MercuryMessageStore9=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(q.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStoree();this.$MercuryMessageStored(u.MESSAGES_REORDERED);};u.prototype.$MercuryMessageStored=function(w,x){var y=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',n({messages:y,eventType:w},x));v(this.$MercuryMessageStore0,w,y);};u.prototype.$MercuryMessageStoree=function(){var w=this.$MercuryMessageStore1.messageAt(0);if(w)this.$MercuryMessageStore3=w.timestamp;};function v(w,x,y){p(function(){t.debug('update:'+x,{threadID:w,messageIDs:y.map(function(z){return z.message_id;})});},0);}m(u,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered'});o(u,{updated:true});e.exports=u;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","ArbiterMixin","BanzaiLogger","ChatConfig","ChatConversation.react","ChatTypingIndicators.react","ChatWelcomeMessage","CSS","DOM","Event","MercuryLastMessageIndicator.react","LiveTimer","MercuryTypingIndicator","MercuryViewer","MercuryConfig","MercuryMessageStore","React","ServerTime","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","UserAgent_DEPRECATED","arrayContains","copyProperties","getElementPosition","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){'use strict';var ja=70,ka=null,la=20;function ma(oa){if(ka===null){var pa=oa.childNodes[0];ca.set(oa,'overflow','scroll');ka=pa.clientWidth-ja;ca.set(oa,'overflow','');}return ka;}function na(oa,pa,qa,ra,sa,ta,ua,va){this.loadingIcon=sa;this.threadID=oa;this.sheetController=pa;this.scrollContainer=qa;this.conversationElem=ra;this.tabView=va;s.restart(y.get()/1000);this._loadingMoreMessages=false;function wa(){na.inform('interaction-with-tab',oa);}this._subscriptions=new da();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),q.listen(this.scrollContainer,'mousedown',wa));if(ea.firefox()){var xa=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(xa,wa,false);}else this._subscriptions.addSubscriptions(q.listen(this.scrollContainer,'mousewheel',wa));this._subscriptions.addSubscriptions(q.listen(this.scrollContainer,'scroll',ia(this.scrolling,50,this)));if(k.get('chat_react')){var ya;x.render(x.createElement(m,{threadID:this.threadID,indicatorsWillShow:function(){return ya=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return ya&&this.scrollToBottom(true);}.bind(this)}),ua);}else this.typingIndicator=new t(this.threadID,ua,this);var za;this.lastMessageIndicatorNode=ta;this.lastMessageIndicator=x.render(x.createElement(r,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return za=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return za&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);this.initializeConversation();}ga(na,i);ga(na.prototype,{initializeConversation:function(){this._store=new w(this.threadID);this._conversation=x.render(x.createElement(l,{maxBubbleWidth:ma(this.scrollContainer),messages:[],onImageLoad:function(oa){var pa=this.scrollContainer,qa=pa.scrollTop+pa.clientHeight;if(qa+oa.offsetHeight>=pa.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(oa,pa,qa){na.inform('video-call-clicked',{userID:oa,threadID:pa,clickSource:qa});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(function(oa){if(oa.eventType==w.MESSAGES_RECEIVED&&oa.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(oa.eventType==w.MESSAGES_REORDERED){this._loadingMoreMessages=false;o.hide(this.loadingIcon);}var pa=this.isScrolledToBottom(),qa=this._getLoadingHeight(),ra=this.scrollContainer.scrollHeight,sa=this.scrollContainer.scrollTop,ta=oa.messages,ua=n.getWelcomeMessage(this.threadID);if(ua)ta.push(ua);this._conversation.setProps({messages:ta},function(){if(pa||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(oa.eventType==w.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-ra-qa+sa);}.bind(this));this.lastMessageIndicator.setProps({lastMessage:ta.length>0?ta[ta.length-1]:null});if(oa.eventType==w.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(ta)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(v.WebStickerOptimisticRender&&oa.eventType==w.MESSAGES_CHANGED)this._checkToAnimateSticker();}.bind(this)));},setShouldScrollToBottom:function(oa){this._shouldScrollToBottom=oa;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){o.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){p.scry(this.conversationElem,'.stickerContainer').forEach(function(oa){return x.unmountComponentAtNode(oa);});x.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();x.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(oa){if(!aa.shouldShowStickerReplyNUX()||!oa.length)return false;var pa=oa[oa.length-1];if(pa.author===u.getID())return false;if(pa.has_attachment)return pa.attachments.some(function(qa){return qa.attach_type==='sticker';});return false;},isScrolledToBottom:function(oa){var pa=this.scrollContainer;oa=oa||la;return pa.scrollTop+pa.clientHeight>=pa.scrollHeight-oa;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(oa){this.scrollToPosition(this.scrollContainer.scrollHeight,oa);},scrollToPosition:function(oa,pa){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(pa===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',oa).ease(g.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=oa;},_onStickerClick:function(oa,pa){if(!oa)return;j.log('StickersLoggerConfig',{event:'click_sticker',packid:oa,stickerid:pa});var qa=this.tabView;aa.onTrayDataReady(function(){if(fa(aa.getPackIDsInTray(),oa)){var ra=aa.getPack(oa);if(ra&&ra.isPromoted)z.addPack(oa);qa.setStickersFlyoutPackID(oa);}else ba.showStore(oa);});},_checkToAnimateSticker:function(){var oa=ha(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:oa.y,viewHeight:oa.height});},setNewThreadID:function(oa){this._store.setNewThreadID(oa);}});e.exports=na;},null);
__d("ChatTabTypeaheadRenderer",["MercuryConstants","DOM","CompactTypeaheadRenderer","MercuryThreadMetadataRawRenderer","TypeaheadFacepile"],function(a,b,c,d,e,f,g,h,i,j,k){function l(n,o){switch(n.type){case g.MercuryTypeaheadConstants.USER_TYPE:case g.MercuryTypeaheadConstants.PAGE_TYPE:return i(n,o);case g.MercuryTypeaheadConstants.THREAD_TYPE:return m(n,o);default:return h.create('div');}}function m(n,o){var p=[],q=n.mercury_thread,r=n.participants_to_render.map(function(u){return u.big_image_src||u.image_src;});if(r){if(r instanceof Array){r=k.render(r);}else r=h.create('img',{alt:'',src:r});p.push(r);}var s=q.name,t=j.renderRawParticipantList(q.thread_id,n.participants_to_render,q.participants.length,{names_renderer:j.renderShortNames});p.push(h.create('span',{className:'timestamp'},q.timestamp_relative));p.push(h.create('span',{className:'text'},s));p.push(h.create('span',{className:'subtext'},t));return h.create('li',{className:'node'},p);}l.className='compact';e.exports=l;},null);
__d("ChatAddFriendsTabSheetRawRenderer",["ChatTabTypeaheadRenderer","ContextualTypeaheadView","DOM","Event","MercuryConfig","MercuryDataSourceWrapper","MercuryTypeahead","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={render:function(q,r,s,t,u,v){var w=v?n[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():n[':fb:mercury:chat:tab-sheet:add-friends'].build(),x={};if(k.MercuryDataSourceProcessor){x=v?l.chat_typeahead_source:l.chat_add_people_source;x.setShowThreads(v);}else if(k.GroupThreadNewMessageGK&&v){x=l.chat_tab_composer_source;x.setShowThreads(v);}else if(v){x=l.source;}else x=l.add_people_source;var y=new m(x,h);y.setViewOption('renderer',g);y.setExcludedParticipantsFromThreadMeta(t);if(!v)y.setPlaceholder("\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19\u0e43\u0e19\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e19\u0e35\u0e49");y.build();i.replace(w.getNode('participantsTypeahead'),y.getElement());i.setContent(s,w.getRoot());y.getTokenizer().adjustWidth();var z=w.getNode('participantsTypeahead').getAttribute('data-labelid'),aa=i.scry(y.getElement(),'input[type="text"]')[0];if(aa)if(z){aa.setAttribute('aria-labelledby',z);}else aa.setAttribute('aria-label',"\u0e16\u0e36\u0e07");y.focus();if(!v){var ba=function(){var ca=y.getSelectedParticipantIDs();if(ca.length)u(ca);r.close(q);};j.listen(w.getNode('doneButton'),'click',ba);y.subscribe('tokens-return',function(){if(y.getTokens().length)ba();});}return y;}};e.exports=p;},null);
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryIDs","MercuryLocalIDs","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get();function o(){}i(o,{subscribe:function(p,q){p.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(p,q);}.bind(this));},createGroupThreadFromChooserDialog:function(p,q){var r=j.serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=[];for(var u in s)if(s[u])t.push(u);var v=o.createThreadForFBIDs(t);m.subscribe('update-thread-ids',function(w,x){for(var y in x)if(x[y]==v)new g('/ajax/groups/chat/log',{group_id:q,message_id:y}).send();});p.hide();},createThreadForTokens:function(p){if(!p.length)return;var q=p.length===1?k.getThreadIDFromUserID(p[0].split(':')[1]):l.generateThreadID();n.createNewLocalThread(q,p);h.openThread(q,'MultiChatController');},createThreadForFBIDs:function(p){var q=[];for(var r=0;r<p.length;r++)q.push("fbid:"+p[r]);return o.createThreadForTokens(q);}});e.exports=o;},null);
__d("ChatAddFriendsTabSheet",["Arbiter","ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","ChatOpenTab","MercuryConfig","MercuryConstants","MercuryLogMessageType","MercurySourceType","MultiChatController","Style","copyProperties","MercuryMessages","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryMessages').get(),s=b('MercuryThreadActions').get(),t=b('MercuryThreads').get();function u(y,z,aa){this._threadID=y;this._rootElement=z;this._sheetView=aa;this._typeahead=null;}q(u.prototype,h,{render:function(){t.getThreadMeta(this._threadID,function(y){var z=y.is_canonical_user?v:w,aa=t.isNewEmptyLocalThread(this._threadID);this._typeahead=i.render(this,this._sheetView,this._rootElement,y,z.bind(null,y),aa);this._typeahead.subscribe('tokens-changed',function(){if(k.GroupThreadNewMessageGK){if(aa)x(this,this._typeahead,this._threadID);}else this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return p.get(this._rootElement,'height');}});function v(y,z){var aa=y.participants;o.createThreadForTokens(aa.concat(z));}function w(y,z){var aa=y.thread_id;if(t.isEmptyLocalThread(aa)){s.addParticipants(aa,z);}else r.sendMessage(r.constructLogMessageObject(n.CHAT_WEB,aa,m.SUBSCRIBE,{added_participants:z}));j.openThread(aa,'ChatAddFriendsTabSheet');}function x(y,z,aa){var ba=z.getTypeahead().getData(),ca=z.getTokens();ba.setShowThreads(ca.length===0);var da=ca.length==1&&ca[0].getInfo().render_type===l.MercuryTypeaheadConstants.THREAD_TYPE;if(da){var ea=ca[0].getInfo().mercury_thread;if(ea)j.openThread(ea.thread_fbid,'openGroupChat','');g.inform('chat/close-tab',aa,'open_group_chat');}else y.inform('chat/tokens-changed',{token_count:z.getTokens().length});}e.exports=u;},null);
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="\u0e40\u0e23\u0e35\u0e22\u0e1a\u0e23\u0e49\u0e2d\u0e22",x="\u0e0b\u0e48\u0e2d\u0e19",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;},null);
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.bind(null,r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.isSheetWithInput=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;},null);
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(n.getNode('text'),"\u0e40\u0e25\u0e37\u0e48\u0e2d\u0e19\u0e25\u0e07\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e14\u0e39\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e43\u0e2b\u0e21\u0e48");i.setContent(this._rootElement,n.getRoot());g.listen(n.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatNoRecipientsTabSheet",["DOM","MercuryViewer","ChatTabTemplates","copyProperties","fbt","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreads').get(),m=b('MercuryThreadInformer').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;m.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}j(n.prototype,{render:function(){var o=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=h.getID(),q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;},null);
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","JSXDOM","Event","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(u,v,w){this._rootElement=v;this._sheetView=w;this._logger=m.create('blackbird');this._canonicalUser=n.getUserIDFromThreadID(u);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}q(t.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var u=p[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),v='fbid:'+this._canonicalUser;o.get(v,function(w){var x='fbChatGoOnlineLink',y=k.a({href:"#",className:x},"\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17"),z=s._("\u0e2b\u0e32\u0e01\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e01\u0e31\u0e1a {name} \u0e41\u0e25\u0e30\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e19\u0e04\u0e19\u0e2d\u0e37\u0e48\u0e19\u0e46 {link}",[s.param("name",w.short_name),s.param("link",y)]);j.setContent(u.getNode('text'),z);i.addClass(u.getRoot(),"_1sk1");j.setContent(this._rootElement,u.getRoot());l.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),x)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(u){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(u){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=t;},null);
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","fbt","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m,n){this._threadID=l;this._rootElement=m;this._sheetView=n;}j(k.prototype,{render:function(){var l=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(l.getNode('text'),"\u0e01\u0e48\u0e2d\u0e19\u0e17\u0e35\u0e48\u0e04\u0e38\u0e13\u0e08\u0e30\u0e2a\u0e48\u0e07\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21 \u0e42\u0e1b\u0e23\u0e14\u0e23\u0e2d\u0e08\u0e19\u0e01\u0e27\u0e48\u0e32\u0e01\u0e32\u0e23\u0e2d\u0e31\u0e1e\u0e42\u0e2b\u0e25\u0e14\u0e08\u0e30\u0e40\u0e2a\u0e23\u0e47\u0e08\u0e2a\u0e21\u0e1a\u0e39\u0e23\u0e13\u0e4c");g.setContent(this._rootElement,l.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=k;},null);
__d("ChatReadOnlyTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyTabSheet0=l;this.$ChatReadOnlyTabSheet1=m;this.$ChatReadOnlyTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getReason(j.getThreadMetaNow(this.$ChatReadOnlyTabSheet0));g.render(g.createElement("div",{className:"_87-"},l),this.$ChatReadOnlyTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyTabSheet2.open(this);};e.exports=k;},null);
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;}k(m.prototype,h,{render:function(){var n=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(n.getNode('text'),"This conversation is muted. Chat tabs will not pop up for it and push notifications are off.");i.setContent(this._rootElement,n.getRoot());g.listen(n.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=m;},null);
__d("ChatEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","ChatTabTemplates"],function(a,b,c,d,e,f,g,h,i,j){var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";this.$ChatEmployeeAwaySheet0=o;this.$ChatEmployeeAwaySheet1=p;this.$ChatEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$ChatEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$ChatEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$ChatEmployeeAwaySheet2.close(this);};e.exports=n;},null);
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryIDs","MercuryParticipants","ChatTabTemplates","copyProperties","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=m.getUserIDFromThreadID(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;n.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("\u0e04\u0e38\u0e13\u0e44\u0e14\u0e49\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name} \u0e41\u0e15\u0e48\u0e04\u0e38\u0e13\u0e08\u0e30\u0e22\u0e31\u0e07\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e2a\u0e48\u0e07\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e16\u0e36\u0e07\u0e40\u0e18\u0e2d\u0e44\u0e14\u0e49",[r.param("name",v.short_name)]);break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("\u0e04\u0e38\u0e13\u0e44\u0e14\u0e49\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name} \u0e41\u0e15\u0e48\u0e04\u0e38\u0e13\u0e08\u0e30\u0e22\u0e31\u0e07\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e2a\u0e48\u0e07\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e16\u0e36\u0e07\u0e40\u0e02\u0e32\u0e44\u0e14\u0e49",[r.param("name",v.short_name)]);break;default:w=r._("\u0e04\u0e38\u0e13\u0e44\u0e14\u0e49\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name} \u0e41\u0e15\u0e48\u0e04\u0e38\u0e13\u0e08\u0e30\u0e22\u0e31\u0e07\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e2a\u0e48\u0e07\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e16\u0e36\u0e07\u0e1e\u0e27\u0e01\u0e40\u0e02\u0e32\u0e44\u0e14\u0e49",[r.param("name",v.short_name)]);}i.setContent(t.getNode('text'),w+' ');var x=r._("\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name} \u0e43\u0e0a\u0e48\u0e2b\u0e23\u0e37\u0e2d\u0e44\u0e21\u0e48",[r.param("name",v.short_name)]);i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;n.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;},null);
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatThreadIsMutedTabSheet","ChatEmployeeAwaySheet","ChatUserBlockedTabSheet","MercuryIDs","MercurySheetView","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=function(u,v,w){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new n(u,v,this._sheetView);this._employeeAwaySheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);if(!q.getUserIDFromThreadID(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};s(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},openEmployeeAwaySheet:function(){this._employeeAwaySheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;},null);
__d("ChatTitleLink.react",["Link.react","MercuryThreadTitle.react","React","TrackingNodes","cx"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=i.createClass({displayName:"ChatTitleLink",propTypes:{href:i.PropTypes.string,isNewThread:i.PropTypes.bool,thread:i.PropTypes.object,viewer:i.PropTypes.string},getDefaultProps:function(){return {href:null};},getTitle:function(){return this.refs.threadTitle.getTitle();},render:function(){if(!this.props.thread)return null;return (i.createElement(g,{"aria-level":"3",className:(("titlebarText")+(this.props.href===null?' '+"noLink":'')),"data-ft":j.getTrackingInfo(j.types.TITLE),"data-hover":"tooltip",href:this.props.href},i.createElement(h,{ref:"threadTitle",isNewThread:this.props.isNewThread,thread:this.props.thread,useAndSeparator:true,useShortName:!this.props.thread.is_canonical,viewer:this.props.viewer})));}});e.exports=l;},null);
__d("ChatVideoCallButton.react",["Link.react","ReactComponentWithPureRenderMixin","React","TrackingNodes","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=i.createClass({displayName:"ChatVideoCallButton",mixins:[h],propTypes:{onClick:i.PropTypes.func,onKeyUp:i.PropTypes.func,shown:i.PropTypes.bool,tooltipLabel:i.PropTypes.string},getDefaultProps:function(){return {tooltipLabel:("\u0e40\u0e23\u0e34\u0e48\u0e21\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e17\u0e32\u0e07\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d")};},render:function(){var n=j.getTrackingInfo(j.types.VIDEOCHAT),o=JSON.stringify({videochat:'call_clicked_bhat_tab'});return (i.createElement(g,{"aria-label":this.props.tooltipLabel,className:(("videoicon")+(' '+"button")+(!this.props.shown?' '+"hidden_elem":'')),"data-ft":n,"data-gt":o,"data-hover":"tooltip","data-tooltip-position":"above",onClick:this.props.onClick,onKeyUp:this.props.onKeyUp}));}});e.exports=m;},null);
__d("EmoticonUtils",["EmoticonsList","Parent","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j){var k='emoticon_',l=g.symbols,m={getEmoteFromTarget:function(n){var o=h.byClass(n,'emoticon');if(!o)return null;var p=null;o.className.split(' ').forEach(function(q){if(j(q,k))p=q.substring(k.length);});return l[p]||null;},insertEmoticon:function(n,o,p){var q=o.substring(0,p.start),r=o.substring(p.end);if(p.start>0&&!i(q,' '))n=' '+n;if(!j(r,' '))n+=' ';var s=q+n+r;p.start+=n.length;p.end=p.start;return {result:s,start:p.start,end:p.end};}};e.exports=m;},null);
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;},null);
__d("StickerSearchNUX.react",["React","ReactLayeredComponentMixin","StickerServerRequests","XUIAmbientNUX.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.createClass({displayName:"StickerSearchNUX",mixins:[h],getInitialState:function(){return {nuxShown:true};},componentDidMount:function(){i.markSeenSearchTooltipNUX();},hideNUX:function(){this.setState({nuxShown:false});},onCloseButtonClicked:function(){this.hideNUX();this.props.showIndicatorFunc();},renderLayers:function(){return {stickerSearchNUX:g.createElement(j,{ref:"NUX",contextRef:"container",shown:this.state.nuxShown,position:"above",width:"auto",onCloseButtonClick:this.onCloseButtonClicked},"\u0e02\u0e13\u0e30\u0e19\u0e35\u0e49\u0e04\u0e38\u0e13\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e04\u0e49\u0e19\u0e2b\u0e32\u0e2a\u0e15\u0e34\u0e01\u0e40\u0e01\u0e2d\u0e23\u0e4c\u0e44\u0e14\u0e49\u0e41\u0e25\u0e49\u0e27!")};},render:function(){return (g.createElement("span",{ref:"container"}));}});e.exports=l;},null);
__d("XStickerReplyNUXControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/stickers\/tooltip\/",{});},null);
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","BanzaiODS","ChatAddToThreadButton.react","ChatArchiveWarning.react","ChatBehavior","ChatCloseButton.react","ChatConfig","ChatContextualDialogController","ChatEmployeeAwayWarning","ChatOpenTab","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","MercurySharePreview.react","ChatStickerButton.react","ChatStickerTriggerController","ChatTabMenu.react","ChatTabMessagesView","ChatTabSheetController","ChatTitleLink.react","ChatVisibility","ChatVideoCallButton.react","MercuryConstants","ContentRollFlyout.react","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMEvent","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","Focus","ImmutableObject","Input","Keys","Locale","LogHistory","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingAnimation.react","MercuryTypingReceiver","MercuryViewer","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","SelectionPosition","StickerActions","StickerConfig","StickerConstants","StickersFlyout.react","StickerState","StickerSearchNUX.react","Style","SubscriptionsHandler","SyntheticMouseEvent","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URLScraper","URI","UserAgent_DEPRECATED","VideoCallCore","WaterfallIDGenerator","WebMessengerThreadPermalinks","XStickerReplyNUXControllerURIBuilder","copyProperties","cx","csx","fbt","getActiveElement","isEmpty","setIntervalAcrossTransitions","ChatReactInput","OrionTrigger","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc){"use strict";var xc=b('ChatReactInput').module,yc=b('OrionTrigger').module,zc=b('MercuryMessages').get(),ad=b('MercuryServerRequests').get(),bd=b('MercuryThreadInformer').get(),cd=b('MercuryThreadMetadataRenderer').get(),dd=b('MercuryThreadActions').get(),ed=b('MercuryThreads').get(),fd=/^\s*$/,gd={},hd=null,id,jd=10,kd=bb.getInstance('chat_tab_view');function ld(ge,he){var ie=pa.create('div');he=he&&he.filter(function(le){return le!=mb.getID();});if(vc(he))return hc.remove(ge);var je=he.length,ke=je-jd;if(ke>1)he=he.slice(0,jd);gb.getMulti(he,function(le){for(var me in le){var ne=le[me],oe=ec[':fb:mercury:chat:multichat-tooltip-item'].build();pa.setContent(oe.getNode('name'),ne.name);var pe=db.getUserIDFromParticipantID(me),qe=pe&&rb.get(pe)==l.ACTIVE;la.conditionShow(oe.getNode('icon'),qe);la.conditionClass(oe.getNode('name'),'tooltipItemWithIcon',qe);pa.appendContent(ie,oe.getRoot());}if(ke>1){var re=tc._("and {number of hidden chat participants} more.",[tc.param("number of hidden chat participants",ke)]);pa.appendContent(ie,pa.create('div',{},re));}hc.set(ge,ie,'above');});}var md={},nd=null,od=false;function pd(ge,he,ie){if(ie){md[ge]=he;if(!nd)nd=wc(qd,600);}else{la.removeClass(he,'highlightTitle');delete md[ge];}}function qd(){for(var ge in md){var he=md[ge];if(he.parentNode){la.conditionClass(he,'highlightTitle',od);}else delete md[ge];}od=!od;if(!Object.keys(md).length){clearInterval(nd);nd=null;}}function rd(ge){var he=db.tokenize(ge);switch(he.type){case 'user':return ec[':fb:mercury:chat:user-tab'].build();}return ec[':fb:mercury:chat:multichat-tab'].build();}function sd(ge){var he=ge._getInputValue(),ie=ge._fileUploader.getAttachments();if(yd(ge))ud(ge,he,ie,function(je){var ke=ge._fileUploader.getImageFiles();if(ke.length>0){je.image_ids=ke;je.has_attachment=true;}var le=ge._fileUploader.getVideoFiles();if(le.length>0){je.video_ids=le;je.has_attachment=true;}var me=ge._fileUploader.getAudioFiles();if(me.length>0){je.audio_ids=me;je.has_attachment=true;}var ne=ge._fileUploader.getFiles();if(ne.length>0){je.file_ids=ne;je.has_attachment=true;}zc.sendMessage(je);ge._fileUploader.removeAttachments();ge._shareLinkUploader&&ge._shareLinkUploader.clear();if(ge._sharePreview)ge._sharePreview.setProps({share:null,uri:null});if(!r.get('chat_react_input'))ge._getNode('input').value='';ge._typingDetector&&ge._typingDetector.resetState();ge._messagesView&&ge._messagesView.setShouldScrollToBottom(true);});}function td(ge,he){if(he===0)return;be(ge,pb.POST_PUBLISHED,{count:he});ge._waterfallID=nc.generate();}function ud(ge,he,ie,je){ed.getThreadMeta(ge._threadID,function(ke){var le=zc.constructUserGeneratedMessageObject(he,hb.CHAT_WEB,ge._threadID);if(ie.length>0){le.has_attachment=true;le.raw_attachments=ie;}if(ge._shareLinkUploader){var me=ge._shareLinkUploader.getAttachData();if(me){le.has_attachment=true;le.content_attachment=me;}}if(ge._sharePreview){var ne=ge._sharePreview.getShareID();if(ne){le.has_attachment=true;le.shareable_attachment=ne;}}if(ed.isNewEmptyLocalThread(ge._threadID)){var oe=ge._sheetController.getAddFriendsParticipants();if(oe===null||oe.length===0)return;oe=oe.filter(function(qe){return qe!=mb.getID();});if(oe.length===0){le.thread_id=db.getThreadIDFromUserID(ka.getID());}else if(oe.length===1){le.thread_id=db.getThreadIDFromParticipantID(oe[0]);}else dd.addParticipants(ge._threadID,oe);}if(ed.isEmptyLocalThread(ge._threadID)){le.message_id=db.tokenize(ge._threadID).value;var pe=ed.getThreadMetaNow(ke.thread_id);le.specific_to_list=Array.from(pe.participants);}if(typeof le!='undefined')le.signatureID=ge._signatureID;le.ui_push_phase=ia.UIPushPhase;je(le);if(ge._threadID!==le.thread_id&&!ge._photoUploader.isUploading()){ce.inform('closed-tab',ge._threadID);u.openThread(le.thread_id,'ChatTabView');}});}function vd(ge){ge._blocked=true;ge._sheetController.openUploadWarningTabSheet();}function wd(ge){return (ge._fileUploader.isUploading()||ge._photoUploader.isUploading()||(ge._sharePreview&&ge._sharePreview.isLoading()));}function xd(ge){return (ge._fileUploader.isUploading()||(ge._sharePreview&&ge._sharePreview.isLoading()));}function yd(ge){var he=ge._getInputValue();if(!fd.test(he))return true;if(ge._fileUploader.getAttachments().length>0||ge._fileUploader.getImageFiles().length>0||ge._fileUploader.getVideoFiles().length>0||ge._fileUploader.getAudioFiles().length>0||ge._fileUploader.getFiles().length>0)return true;if(ge._shareLinkUploader&&ge._shareLinkUploader.getAttachData())return true;if(ge._sharePreview&&ge._sharePreview.getShareID())return true;return false;}function zd(ge){if(ge._blocked){if(xd(ge))return;ge._blocked=false;sd(ge);ge._sheetController.closeUploadWarningTabSheet();}}function ae(ge){ge._nubController.flyoutContentChanged();var he=ge._getNode('attachmentShelf');he.scrollTop=he.scrollHeight;}function be(ge,he,ie){pb.sendSignal(qc({qn:ge._waterfallID,step:he,uploader:pb.APP_CHAT},ie||{}));}function ce(ge,he,ie,je,ke){if(he)ad.ensureThreadIsFetched(he);this._threadID=ge;this._signatureID=ie;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=rd(ge);this._tabElem=this._tabTemplate.getRoot();if(ke){this.insertBefore(ke);}else this.appendTo(je);this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=nc.generate();this._subscriptionsHandler=new cc();this._initializeAutoSendPhotoUploader();this._stickersFlyoutShown=false;var le=ra.scry(this._tabElem,"._1ia");if(le&&le.length>0){this._dropTarget=new sa(le[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}this._sheetController=new ea(this._threadID,this._getNode('sheet'),this._tabElem);if(r.get('chat_react_option_menu')){this._initializeReactMenu(this._getNode('fileAttachmentShelf'));}else{this._fileUploader=new eb(this._getNode('fileAttachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);}this._initializeArchiveWarning();this._initializeAddToThreadButton();this._initializeVideoCallButton();this._initializeCloseButton();this._initializeTitle();this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();ce.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){dd.unmute(this._threadID);this.focus();}.bind(this));this._nubController=new nb().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(re,se){ed.getThreadMeta(this._threadID,function(te){this._updateControls(te,se.token_count);}.bind(this));}.bind(this));if(hd===null)hd=!r.get('seen_autosend_photo_nux');this._messagesView=null;if(r.get('chat_react_option_menu')){oc.getThreadURI(ge,function(re){return this._setTitleHref(re);}.bind(this));}else{var me=this._getNode('conversationLink');la.hide(me);cd.renderWebMessengerLink(ge,me,function(){la.show(me);this._setTitleHref(me.href);}.bind(this));}if(!db.getUserIDFromThreadID(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ne=this._getCanonicalUserID();if(this._getCanonicalUserID()){gb.get(db.getParticipantIDFromUserID(ne),function(re){if(re.href)this._setTitleHref(re.href);}.bind(this));}else if(r.get('chat_react_option_menu')&&this._reactChatTabMenu.getURL()){this._setTitleHref(this._reactChatTabMenu.getURL());}else if(me&&me.href)this._setTitleHref(me.href);this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('createGroupLink','click',this._createGroupClicked,true);this._listen('enableDesktopNotif','click',this._enableDesktopNotif,true);this._listen('muteThreadLink','click',jb.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){dd.unmute(this._threadID);gc.hide();}.bind(this),true);this._listen('switchToWorkUserLink','click',this._switchToWorkUserClicked,true);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===za.TAB){this._focusInput();event.kill();}}.bind(this));this._stickersFlyoutToggler=this._getNode('emoticons');if(wb.WebStickerTrigger)this._stickerTriggerController=new ba(this._getNode('stickersTriggerFlyoutContainer'),this._getNode('emoticonIndicator'),this._stickersFlyoutToggler,this._stickerSelected.bind(this),this._searchStickers.bind(this));this._initializeInput();if(zb.shouldShowStickerSearchNUXIndicator()){this._addStickerSearchNUXIndicator();this._listen('emoticons','click',function(){if(zb.shouldShowStickerSearchNUXIndicator()){vb.selectPack(xb.SEARCH_PACK_ID);zb.clearShowStickerSearchNUXIndicator();}g.inform('stickerSearchNUXIndicator/hide');},true);g.subscribeOnce('stickerSearchNUXIndicator/hide',function(){this._clearStickerSearchNUXIndicator();this._clearStickerSearchNUXTooltip();}.bind(this));ce.subscribe('lower-activated',function(re,se){if(se===this._threadID&&zb.shouldShowStickerSearchNUXIndicator()){this._clearStickerSearchNUXTooltip();this._addStickerSearchNUXIndicator();}}.bind(this));}if(r.get('chat_react_sticker_button')){this._stickerButton=sb.render(sb.createElement(aa,{onFlyoutShown:this._onFlyoutShown.bind(this),onFlyoutHidden:this._onFlyoutHidden.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));m.bumpEntityKey('chat.web','sticker_button.mounting_attempted');}else{var oe=this._getNode('stickers');if(oe)this._stickersFlyout=sb.render(sb.createElement(yb,{onStickerSelect:function(re){this._stickerSelected(re);}.bind(this),onShown:this._onFlyoutShown.bind(this),onHidden:this._onFlyoutHidden.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),oe);this._eventListeners.push(zb.addListener(zb.PACK_SELECTED,function(re){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:re});}.bind(this)));}if(yc){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=sb.render(sb.createElement(yc,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);}var pe=this._getNode('contentRoll');if(pe)sb.render(sb.createElement(ja,{onSelection:function(re){if(this._shareLinkUploader)this._shareLinkUploader.loadShare(re.url,{content_roll_entry:re});this.focus();}.bind(this),userID:ka.getID()}),pe);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new w(ne,this._updatePrivacyLink.bind(this));this._eventListeners.push(va.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}ed.getThreadMeta(this._threadID,function(re){this._setUpMutingSettings(re);}.bind(this));x.removeEmptyHrefs(this._tabElem);gd[ge]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var qe={threadID:ge,userID:ne,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',qe).send();tb.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(zc.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);tb.onUnload(function(){de(this);}.bind(this));}function de(ge){if(ge._photoUploader.isUploading())be(ge,pb.CANCEL_DURING_UPLOAD);}function ee(){for(var ge in gd){gd[ge].updateAvailableStatus();gd[ge].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],ee);qb.subscribe(['privacy-changed','privacy-availability-changed'],ee);p.subscribe(p.ON_CHANGED,function(){for(var ge in gd)ed.getThreadMeta(ge,function(he){gd[ge]._updateUnreadCount(he);});});lb.addRetroactiveListener('state-changed',function(ge){for(var he in ge){var ie=ge[he]&&ge[he].length,je=gd[he];je&&je.showTypingIndicator(ie);}});bd.subscribe('threads-updated',function(ge,he){for(var ie in gd){var je=gd[ie];he[ie]&&je.updateTab();if(je._newThreadIDFromPhotoUpload&&!je._photoUploader.isUploading()&&he[je._newThreadIDFromPhotoUpload]){ce.inform('closed-tab',je._threadID);u.openThread(je._newThreadIDFromPhotoUpload,'ChatTabView');je._newThreadIDFromPhotoUpload=null;}}});bd.subscribe('threads-deleted',function(ge,he){for(var ie in gd)he[ie]&&ce.inform('thread-deleted',ie);});qc(ce,h,{get:function(ge){return gd[ge];}});qc(ce.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(ge){setTimeout((function(){this._sheetController.openNameConversationSheet(ge);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return la.shown(this._tabElem);},setVisibleState:function(ge,he){var ie=la.shown(this._tabElem),je=la.hasClass(this._tabElem,'opened');la.conditionShow(this._tabElem,ge);la.conditionClass(this._tabElem,'opened',he);if(!(ie&&je)&&ge&&he){if(!this._messagesView)this._messagesView=new da(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(ie&&je&&!(ge&&he))this._contextualDialogController&&this._contextualDialogController.tabNotActive();},focus:function(){if(la.hasClass(this._tabElem,'opened')){this._focusInput();}else this._getNode('dockButton').focus();},isFocused:function(){var ge=uc();return ob.byClass(ge,"_50mz")===this._tabElem;},hasEmptyInput:function(){var ge;if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return false;ge=this._chatInput.getValue();}else ge=this._getNode('input').value;return fd.test(ge);},getInputElem:function(){if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return null;return this._chatInput.getDOMNode();}else return this._getNode('input');},setStickersFlyoutPackID:function(ge){if(this._stickerButton){this._setPackIDReact(ge);}else this._setPackIDLegacy(ge);},loadShareFromParams:function(ge,he){this._shareLinkUploader&&this._shareLinkUploader.loadShareFromParams(ge,he);if(this._sharePreview)this._sharePreview.setProps({share:{params:he,type:ge},uri:null});},_linkDropped:function(ge){this._shareLinkUploader&&this._shareLinkUploader.loadShare(ge);if(this._sharePreview)this._sharePreview.setProps({share:null,uri:ge});},_filesDropped:function(ge){if(this._fileUploader)this._fileUploader.addDroppedFiles(ge);},showStickerSearchNUXTooltip:function(){if(id)return;id=true;this._clearStickerSearchNUXIndicator();this._stickerSearchNUXTooltip=sb.render(sb.createElement(ac,{showIndicatorFunc:this._addStickerSearchNUXIndicator.bind(this)}),this._getNode('tooltipNUXContainer'));},_setPackIDLegacy:function(ge){var he=this._stickersFlyout;if(!this._stickersFlyoutToggler||!he||!he.isMounted())return;vb.selectPack(ge);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(ge){if(!this._stickerButton.isMounted())return;vb.selectPack(ge);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(ge){this._stickerButton.showFlyout();this._stickersFlyoutShown=ge;},_toggleStickersFlyoutShownLegacy:function(ge){if(ge){gc.show(this._stickersFlyoutToggler);}else gc.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=ge;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(id)return;var ge=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new j(new pc().getURI()).setRelativeTo(ge).setData({thread_id:this._threadID}).setHandler(function(he){zb.clearShowStickerReplyNUX();}).send();},insertBefore:function(ge){pa.insertBefore(ge._tabElem,this._tabElem);},appendTo:function(ge){pa.appendContent(ge,this._tabElem);},nextTabIs:function(ge){var he=ge&&ge._tabElem;return this._tabElem.nextSibling==he;},getScrollTop:function(){return pa.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop;},setScrollTop:function(ge){pa.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop=ge;},_unmountComponentAtNodeSafe:function(ge){var he=this._getNode(ge);he&&sb.unmountComponentAtNode(he);},destroy:function(){this._selectionPosition&&this._selectionPosition.disable();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();if(r.get('chat_react_option_menu')){sb.unmountComponentAtNode(this._getNode('menuContainer'));}else this._fileUploader&&this._fileUploader.destroy();if(r.get('chat_react_header')){sb.unmountComponentAtNode(this._getNode('addToThreadContainer'));this._unmountComponentAtNodeSafe('archiveContainer');this._unmountComponentAtNodeSafe('videoCallButtonContainer');sb.unmountComponentAtNode(this._getNode('closeButtonContainer'));sb.unmountComponentAtNode(this._getNode('titleContainer'));}if(r.get('chat_react_share_uploader')&&this._sharePreview&&this._sharePreview.isMounted()){sb.unmountComponentAtNode(this._sharePreview.getDOMNode());}else this._shareLinkUploader&&this._shareLinkUploader.clear();sb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));if(r.get('chat_react_sticker_button')){sb.unmountComponentAtNode(this._getNode('stickerButtonContainer'));}else sb.unmountComponentAtNode(this._getNode('stickers'));if(wb.WebStickerTrigger)this._stickerTriggerController.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();if(r.get('chat_react_input')){sb.unmountComponentAtNode(this._getNode('inputContainer'));}else ya.reset(this._getNode('input'));pa.remove(this._tabElem);delete gd[this._threadID];oa.unregisterNubController(this._nubController);},updateAvailableStatus:function(){ed.getThreadMeta(this._threadID,function(ge){var he=l.OFFLINE,ie=false,je=this._getCanonicalUserID();if(je){he=rb.get(je);ie=mc.availableForCall(je);}else{var ke=ge.participants.map(function(me){return db.getUserIDFromParticipantID(me);});he=rb.getGroup(ke);}if(!ga.isOnline())he=l.OFFLINE;if(je)this._updateCallLink(he);la.conditionClass(this._tabElem,"_5238",he===l.ACTIVE);la.conditionClass(this._tabElem,"_4hwz",ie);la.conditionClass(this._tabElem,"_5239",he===l.MOBILE);var le=this._getNode('presenceIndicator');switch(he){case l.ACTIVE:le.setAttribute('alt',"\u0e2d\u0e2d\u0e19\u0e44\u0e25\u0e19\u0e4c");break;case l.MOBILE:le.setAttribute('alt',"\u0e21\u0e37\u0e2d\u0e16\u0e37\u0e2d");break;default:le.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();ed.getThreadMeta(this._threadID,function(ge){var he=[this._getNode('name')];if(!r.get('chat_react_header')){he.push(this._getNode('titlebarText'));}else if(this._title.isMounted())this._title.setProps({thread:ge},function(){this._getNode('chatWrapper').setAttribute('aria-label',this._title.getTitle());}.bind(this));cd.renderAndSeparatedParticipantList(this._threadID,he,{names_renderer:ib.renderShortNames,check_length:true});this._updateControls(ge);this._updateMutingSettings(ge);this._updateUnreadCount(ge);this.updateMultichatTooltip();this._updateArchiveWarning(ge);this._updateEmployeeAwayWarning(ge);this._updateNewThread(ge);this._updateNameConversationSheet(ge);this._updateReadOnlySheet(ge);this._updateSwitchToWork(ge);}.bind(this));},_setNameConversationLink:function(){var ge=this._getNode('nameConversationLink');if(ge)ed.isEmptyLocalThread(this._threadID)?la.hide(ge):la.show(ge);},_updateNameConversationSheet:function(ge){if(ed.canReply(ge.thread_id)&&!ge.name&&!ge.is_canonical&&!ge.name_conversation_sheet_dismissed&&!ge.has_email_participant&&!ge.read_only&&!ed.isEmptyLocalThread(ge.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(ge){var he=ed.canReply(ge.thread_id),ie=ed.isEmptyLocalThread(ge.thread_id);if(!he&&!ie)this._sheetController.openReadOnlySheet();},updateSignatureID:function(ge){this._signatureID=ge;},_showPhotoNUXIfNecessary:function(){if(hd){hd=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(ge){var he=jb.isThreadMuted(ge);if(he)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(he);},_updateMutingSettings:function(ge){var he=jb.isThreadMuted(ge),ie;if(r.get('chat_react_option_menu')){ie=this._reactChatTabMenu.props.isMuted;}else ie=la.shown(this._getNode('unmuteThreadLink').parentNode);if(he&&!ie){this._sheetController.openThreadIsMutedTabSheet();}else if(!he&&ie)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(he);},_updateActionMenu:function(ge){if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({isMuted:ge});}else{la.conditionShow(this._getNode('muteThreadLink').parentNode,!ge);la.conditionShow(this._getNode('unmuteThreadLink').parentNode,ge);}},_updateArchiveWarning:function(ge){var he=false;gb.get(mb.getID(),function(ie){he=ie.employee;if(he)gb.getMulti(ge.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateEmployeeAwayWarning:function(ge){t.updateEmployeeAwayWarning(ge,function(){this._sheetController.openEmployeeAwaySheet();}.bind(this),function(){});},_updateSwitchToWork:function(ge){var he=false;gb.get(mb.getID(),function(ie){he=ie.employee;if(he)gb.getMulti(ge.participants,this._showSwitchToWorkIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateControls:function(ge,he){var ie=false;if(ge&&ge.thread_id){var je=db.tokenize(ge.thread_id);if(je.type==='user'){var ke=je.value;ie=!ad.isUser(ke);}}var le=ed.canReply(ge.thread_id)&&(!vc(ge.participants)||!!he);la.conditionShow(this._inputContainerNode,le);la.conditionShow(this._iconsContainerNode,le);if(!r.get('chat_react_option_menu')){la.conditionShow(this._getNode('dropdown'),le);}else if(this._reactChatTabMenu.isMounted()){this._reactChatTabMenu.setProps({isEmptyChat:ed.isNewEmptyLocalThread(ge.thread_id),show:le});if(ie)this._reactChatTabMenu.setProps({showAddFriend:null});}var me=le&&!ie;if(r.get('chat_react_header')){this._addToThreadButton.isMounted()&&this._addToThreadButton.setProps({shown:me});}else la.conditionShow(this._getNode('addToThreadLink'),me);this._resizeInputContainer();this._updateOrionTrigger(le);},_updateOrionTrigger:function(ge){if(this._orionTrigger&&ge){var he=this.getParticipantIDForOrionNUX();la.conditionShow(this._orionTriggerContainer,he);if(he){gb.get(he,function(ie){ie=xa.set(ie,{userId:db.getUserIDFromParticipantID(he)});this._orionTrigger.setProps({receiver:ie,disabled:!ie.orion_eligible});if(ie.orion_eligible&&this.isOrionNUXEligible())this.showOrionNUXTooltip();}.bind(this));}else this._orionTrigger.setProps({receiver:{}});}},getParticipantIDForOrionNUX:function(){var ge=this._sheetController.getAddFriendsTabSheet(),he=ge.getParticipants(),ie=this._getCanonicalUserID(),je=null;if(ie){je=db.getParticipantIDFromUserID(ie);}else if(he&&he.length===1)je=he[0];return je;},showOrionNUXTooltip:function(){if(this._orionTrigger&&cb.ShowOrionNUXTooltip)this._orionTrigger.setShouldShowNUXTooltip();},isOrionNUXEligible:function(){var ge=this.getParticipantIDForOrionNUX();return ge&&this.isVisible()&&la.hasClass(this._tabElem,'opened');},_resizeInputContainer:function(){var ge=this._tabElem.clientWidth,he=2,ie=ge-(this._inputContainerNode.clientWidth+he),je=ab.isRTL()?'left':'right';bc.set(this._iconsContainerNode,je,ie+'px');if(!r.get('chat_react_input'))fc.getInstance(this._getNode('input')).update();},_updateNewThread:function(ge){if(ed.isNewEmptyLocalThread(ge.thread_id))this.showAddFriend();},_isEmployeesOnly:function(ge){for(var he in ge)if(!ge[he].employee)return false;return true;},_showArchiveWarningIfAllParticipantsAreEmployees:function(ge){var he=this._isEmployeesOnly(ge),ie=r.get('chat_react_header'),je=ie?this._getNode('archiveContainer'):this._getNode('titanArchiveWarning');if(je){if(this._titlebarTooltipAnchor)la.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',he);if(ie){this._archiveWarning.isMounted()&&this._archiveWarning.setProps({shown:he});}else la.conditionShow(je,he);}},_showSwitchToWorkIfAllParticipantsAreEmployees:function(ge){var he=this._isEmployeesOnly(ge);if(!r.get('chat_react_option_menu')){var ie=this._getNode('switchToWorkUserLink');if(ie)la.conditionShow(ie,he);}else if(this._reactChatTabMenu.isMounted())this._reactChatTabMenu.setProps({hasSwitchToWork:he});},updateMultichatTooltip:function(){ed.getThreadMeta(this._threadID,function(ge){if(!ge.is_canonical){var he;if(r.get('chat_react_header')){he=this._title.getDOMNode();}else he=this._titlebarTooltipAnchor;ld(he,ge.participants);}}.bind(this));},_getNode:function(ge){return this._tabTemplate.getNode(ge);},_getCanonicalUserID:function(){return db.getUserIDFromThreadID(this._threadID);},_listen:function(ge,event,he,ie){var je=this._getNode(ge);if(je){this._eventListeners.push(va.listen(je,event,he.bind(this)));}else if(!ie)throw new Error('Could not find node "'+ge+'"');},_closePreClicked:function(ge){this._closeMouseDown=true;},_closeClicked:function(ge){de(this);ce.inform('closed-tab',this._threadID);if(ge instanceof dc){ge.stopPropagation();return;}ge.kill();},_closeEnter:function(ge){if(ge.keyCode===za.RETURN)this._closeClicked(ge);},_nubClicked:function(ge){if(!this._isDragDropActive){ge.kill();return ce.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===za.RETURN||event.keyCode===za.SPACE){ce.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===za.ESC){this._handleEscape();if(r.get('chat_react_input'))event=new qa(event);event.kill();}else if(event.keyCode===za.TAB)this._handleTabPressed(event);},_handleTabPressed:function(event){if(!event.ctrlKey){var ge=ce.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});if(r.get('chat_react_input'))event=new qa(event);!ge&&event.kill();return true;}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}de(this);if(this.hasEmptyInput()){ce.inform('esc-pressed',this._threadID);}else{var ge="Are you sure you want to close this chat window?",he="\u0e04\u0e38\u0e13\u0e22\u0e31\u0e07\u0e44\u0e21\u0e48\u0e44\u0e14\u0e49\u0e2a\u0e48\u0e07\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13",ie=new na().setTitle(ge).setBody(he).setButtons([na.CLOSE,na.CANCEL]).setHandler(ce.inform.bind(ce,'esc-pressed',this._threadID,null)).setModal(true).show(),je=ie.getButtonElement('yes');je&&wa.set(je);}},_titleClicked:function(event){var ge=event.getTarget();if(!ob.byClass(ge,'titlebarText')&&!ob.byClass(ge,'uiSelector')&&!ob.byClass(ge,'addToThread')&&!ob.byClass(ge,'optionMenu')&&!ob.byClass(ge,'videoicon')&&!ob.byClass(ge,'close')&&!this._isDragDropActive){ce.inform('lower-activated',this._threadID);event.kill();}},_callEnter:function(ge){if(ge.keyCode===za.RETURN)this._callClicked(ge);},_callClicked:function(ge){if(ge.target)ge.target.blur();var he=this._getCanonicalUserID();if(mc.availableForCall(he)){var ie='chat_tab_icon';if(ge.target&&la.hasClass(ge.target,'video_call_tour'))ie='chat_tab_icon_tour';ce.inform('video-call-clicked',{threadID:this._threadID,userID:he,clickSource:ie});}if(r.get('chat_react_header')){ge.stopPropagation();}else return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){ad.getServerThreadID(this._threadID,function(ge){i.send(new j(kc('/ajax/browser/dialog/multichat_members/').addQueryData({id:ge})));});},_clearHistory:function(){var ge=ed.getThreadMetaNow(this._threadID);if(ge){var he=this._getCanonicalUserID();ad.clearChat(this._threadID,he,ge.timestamp);}},_unsubscribeLinkClicked:function(){var ge=[];ge.push({name:'unsubscribe',label:"\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32",handler:this._unsubscribeToThread.bind(this)});ge.push(na.CANCEL);new na().setTitle("\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e43\u0e0a\u0e48\u0e2b\u0e23\u0e37\u0e2d\u0e44\u0e21\u0e48").setBody("\u0e04\u0e38\u0e13\u0e08\u0e30\u0e2b\u0e22\u0e38\u0e14\u0e23\u0e31\u0e1a\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21\u0e08\u0e32\u0e01\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32\u0e19\u0e35\u0e49 \u0e41\u0e25\u0e30\u0e04\u0e19\u0e2d\u0e37\u0e48\u0e19\u0e08\u0e30\u0e40\u0e2b\u0e47\u0e19\u0e27\u0e48\u0e32\u0e04\u0e38\u0e13\u0e2d\u0e2d\u0e01").setButtons(ge).show();},_switchToWorkUserClicked:function(){var ge=[];ge.push({name:'move',label:"Move Conversation",handler:this._switchToWork.bind(this)});ge.push(na.CANCEL);new na().setTitle("Move Conversation to Work Account?").setBody("Do you want to move this conversation so that it shows in your work account instead?").setButtons(ge).show();},_getUserParticipants:function(ge){var he=[];ge.forEach(function(ie){var je=db.getUserIDFromParticipantID(ie);je&&he.push(je);});return he;},_createGroupClicked:function(){ed.getThreadMeta(this._threadID,function(ge){if(!ge.is_canonical){var he=kc('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),ie=this._getUserParticipants(ge.participants);he.addQueryData({members:ie});if(ge.name)he.addQueryData({name:ge.name});i.send(new j(he));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var ge=this._getCanonicalUserID(),he=kc('/ajax/chat/report.php').addQueryData({id:ge}).addQueryData({src:'top_report_link'});i.send(new j(he));},_inputPasted:function(event){if(lc.chrome()){var ge=event.clipboardData||event.originalEvent.clipboardData;if(!ge||!ge.items||ge.items.length<1)return;var he=ge.items[0].type;if(he!=='image/png')return;if(ge.items[0].getAsFile){var ie=ge.items[0].getAsFile();this._photoUploader.uploadFile(ie);}}},_focusInput:function(){if(r.get('chat_react_input')){this._chatInput&&this._chatInput.isMounted()&&this._chatInput.focus();}else this._getNode('input').focus();},_focusTab:function(){la.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController&&this._contextualDialogController.tabFocused();if(!id&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){id=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);ce.inform('focus-tab',this._threadID);},_blurTab:function(){la.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(ge){if(r.get('chat_react_header')){this._closeButton.isMounted()&&this._closeButton.setProps({active:ge});return;}var he=this._getNode('titlebarCloseButton'),ie=ge?"\u0e01\u0e14 Esc \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e1b\u0e34\u0e14":"\u0e1b\u0e34\u0e14\u0e41\u0e17\u0e47\u0e1a";hc.set(he,ie,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();if(event.keyCode===za.RETURN&&!event.shiftKey){if(xd(this)){vd(this);event.kill&&event.kill();return;}sd(this);if(wb.WebStickerTrigger)this._stickerTriggerController.activateAfterparty();event.kill&&event.kill();return;}if(event.keyCode===za.DOWN&&event.shiftKey&&this.hasEmptyInput()){ce.inform('lower-activated',this._threadID);event.kill&&event.kill();return;}this._handleHotkeyPressed(event);},_initializeInput:function(){if(!r.get('chat_react_input')){var ge=this._inputContainerNode.clientHeight;fc.getInstance(this._getNode('input')).subscribe('resize',function(){var he=this._inputContainerNode.clientHeight;if(he!=ge)this._nubController.flyoutContentChanged();ge=he;}.bind(this));this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);if(lc.firefox()&&ma.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._initializeThingsWithInputFn(this._tabTemplate.getNode('input'));}else{this._chatInput=sb.render(sb.createElement(xc,{initializeThingsWithInputFn:this._initializeThingsWithInputFn.bind(this),inputChanged:function(he){if(wb.WebStickerTrigger)this._stickerTriggerController.updateInput(he);}.bind(this),inputKeyDown:this._inputKeyDown.bind(this),onAddMention:this._onAddMention.bind(this),onBlur:this._blurTab.bind(this),onEscape:this._handleEscape.bind(this),onFocus:this._focusTab.bind(this),onTab:this._handleTabPressed.bind(this),openFlyoutFn:this._toggleStickersFlyoutShownLegacy.bind(this,true),stickersFlyoutToggler:this._stickersFlyoutToggler,searchTriggeredWord:function(){this._toggleStickersFlyoutShownLegacy(true);this._searchStickers(this._stickerTriggerController.getTriggeredWord());}.bind(this),resizeFn:this._nubController.flyoutContentChanged.bind(this._nubController),uploadPhotoFn:this._photoUploader.uploadFile}),this._getNode('chatInputContainer'));if(wb.WebStickerTrigger)this._stickerTriggerController.setInput(this._chatInput);}},_initializeSharePreview:function(ge,he){this._sharePreview=sb.render(sb.createElement(z,{className:"_4hom",imageSize:{width:68,height:68},onClose:this._focusInput.bind(this),onUpdate:function(){ae(this);zd(this);}.bind(this)}),this._getNode('shareAttachmentShelf'));va.listen(ge,'keyup',function(){var ie=he?he():ge.value;!ie.length&&this._urlScraper.reset();}.bind(this));this._urlScraper=new jc(ge,he);this._urlScraper.subscribe('match',function(ie,je){this._sharePreview.setProps({share:null,uri:(je&&je.url)});}.bind(this));},_initializeThingsWithInputFn:function(ge,he){if(r.get('chat_react_share_uploader')){this._initializeSharePreview(ge,he);}else{this._shareLinkUploader=new y(this._getNode('shareAttachmentShelf'),ge,this.focus.bind(this),he);this._initializeUploader(this._shareLinkUploader);}ed.getThreadMeta(this._threadID,function(ie){ad.getServerThreadID(this._threadID,function(je){this._typingDetector=new ic(this._getCanonicalUserID(),ge,'mercury-chat',null,je,he);}.bind(this));}.bind(this));},_getInputValue:function(){if(r.get('chat_react_input')){if(!this._chatInput||!this._chatInput.isMounted())return '';return this._chatInput.getValue()||'';}else return this._tabTemplate.getNode('input').value||'';},_hasUnfinishedPost:function(){return yd(this)||wd(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){ce.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(ge){this.tryMarkAsRead();if(ob.byTag(ge.getTarget(),'a')||pa.getSelection())return;this.focus();},_inputContainerClicked:function(ge){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(ge){if(r.get('chat_closed_tab_typing_indicator_animated')){var he=pa.find(this._tabElem,"._54m9");if(ge){this._animatedTypingIndicator=sb.render(sb.createElement(kb,null),he);this._updateAnimatedIndicatorColor();la.addClass(this._tabElem,"_54m8");la.show(he);}else{la.removeClass(this._tabElem,"_54m8");la.hide(he);sb.unmountComponentAtNode(he);this._animatedTypingIndicator=null;}}else la.conditionClass(this._tabElem,'typing',ge);},_updateAnimatedIndicatorColor:function(){if(this._animatedTypingIndicator){var ge=la.hasClass(this._tabElem,'highlightTab')?'light':'dark';this._animatedTypingIndicator.setProps({color:ge});}},_updateUnreadCount:function(ge){var he=ge.unread_count;if(typeof he!='undefined'){var ie=!!he&&(!p.showsTabUnreadUI||p.showsTabUnreadUI()),je=this._getNode('numMessages');la.conditionShow(je,ie);la.conditionClass(this._tabElem,'highlightTab',ie);this._updateAnimatedIndicatorColor();pd(this._threadID,this._tabElem,ie);pa.setContent(je,he);}},_updateCallLink:function(ge){var he=this._getCanonicalUserID();if(he===ka.getID()){this._hideVideoCallouts();if(r.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({shown:false});}else la.hide(this._getNode('videoCallLink'));return;}if(ga.isOnline()){var ie='fbid:'+he;gb.get(ie,function(je){var ke=null;if(mc.availableForCall(he)){ke=tc._("\u0e40\u0e23\u0e34\u0e48\u0e21\u0e04\u0e38\u0e22\u0e41\u0e1a\u0e1a\u0e40\u0e2b\u0e47\u0e19\u0e2b\u0e19\u0e49\u0e32\u0e01\u0e31\u0e1a {firstname}",[tc.param("firstname",je.short_name)]);}else{ke=tc._("{firstname} \u0e44\u0e21\u0e48\u0e1e\u0e23\u0e49\u0e2d\u0e21\u0e43\u0e0a\u0e49\u0e01\u0e32\u0e23\u0e04\u0e38\u0e22\u0e41\u0e1a\u0e1a\u0e40\u0e2b\u0e47\u0e19\u0e2b\u0e19\u0e49\u0e32\u0e43\u0e19\u0e02\u0e13\u0e30\u0e19\u0e35\u0e49",[tc.param("firstname",je.short_name)]);this._hideVideoCallouts();}this._setVideoCallTooltip(ke);}.bind(this));}else{this._setVideoCallTooltip("\u0e04\u0e38\u0e13\u0e15\u0e49\u0e2d\u0e07\u0e2d\u0e2d\u0e19\u0e44\u0e25\u0e19\u0e4c\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e42\u0e17\u0e23");this._hideVideoCallouts();}},_setVideoCallTooltip:function(ge){if(r.get('chat_react_header')){this._videoCallButton.isMounted()&&this._videoCallButton.setProps({tooltipLabel:ge});}else hc.set(this._getNode('videoCallLink'),ge);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(ge){var he;if(ge==w.OFFLINE){he="\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e2d\u0e2d\u0e19\u0e44\u0e25\u0e19\u0e4c";if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:he});}else pa.setContent(this._privacyLink,he);return;}var ie=this._getCanonicalUserID();if(!ie)return;var je='fbid:'+ie;gb.get(je,function(ke){if(ge==w.BLOCKED){he=tc._("\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name}",[tc.param("name",ke.short_name)]);}else he=tc._("\u0e1b\u0e34\u0e14\u0e01\u0e32\u0e23\u0e41\u0e0a\u0e17\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a {name}",[tc.param("name",ke.short_name)]);if(r.get('chat_react_option_menu')){this._reactChatTabMenu.isMounted()&&this._reactChatTabMenu.setProps({privacyText:he});}else pa.setContent(this._privacyLink,he);}.bind(this));},_unsubscribeToThread:function(){if(!ed.isEmptyLocalThread(this._threadID)){var ge=zc.constructLogMessageObject(hb.CHAT_WEB,this._threadID,fb.UNSUBSCRIBE,{removed_participants:[mb.getID()]});zc.sendMessage(ge);}ce.inform('unsubscribed',this._threadID);return true;},_switchToWork:function(){if(!ed.isEmptyLocalThread(this._threadID)){var ge=zc.constructLogMessageObject(hb.CHAT_WEB,this._threadID,fb.SWITCH_TO_WORK,{removed_participants:[mb.getID()]});zc.sendMessage(ge);}ce.inform('unsubscribed',this._threadID);return true;},_initializeUploader:function(ge){this._subscriptionsHandler.addSubscriptions(ge.subscribe(['all-uploads-completed','upload-canceled'],function(){zd(this);}.bind(this)),ge.subscribe('dom-updated',function(){ae(this);}.bind(this)),ge.subscribe('submit',function(){this._focusInput();}.bind(this)));},_initializeReactMenu:function(ge){var he=this._getNode('menuContainer'),ie=db.isMultichat(this._threadID),je=ed.isNewEmptyLocalThread(this._threadID),ke=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(he)this._reactChatTabMenu=sb.render(sb.createElement(ca,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),clearHistoryFunc:this._clearHistory.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),switchToWorkFunc:this._switchToWorkUserClicked.bind(this),isMultichat:ie,isEmptyChat:je,showAddFriend:ke,threadID:this._threadID,attachmentsShelf:ge,onUploadFinished:zd.bind(this,this),onUpdateAttachmentsShelf:ae.bind(this,this),onSubmit:this._focusInput.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),he);},_initializeArchiveWarning:function(){if(r.get('chat_react_header'))this._archiveWarning=sb.render(sb.createElement(o,{isFBAtWork:r.IsWorkUser,shown:true}),this._getNode('archiveContainer'));},_initializeAddToThreadButton:function(){if(r.get('chat_react_header')){this._addToThreadButton=sb.render(sb.createElement(n,{onClick:this._addFriendLinkClicked.bind(this),shown:true}),this._getNode('addToThreadContainer'));}else this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);},_initializeVideoCallButton:function(){if(!db.getUserIDFromThreadID(this._threadID))return;var ge=null;if(r.get('chat_react_header')){this._videoCallButton=sb.render(sb.createElement(ha,{shown:true,onClick:this._callClicked.bind(this),onKeyUp:this._callEnter.bind(this)}),this._getNode('videoCallButtonContainer'));ge=this._videoCallButton.getDOMNode();}else{ge=this._getNode('videoCallLink');this._listen('videoCallLink','click',this._callClicked,true);this._listen('videoCallLink','keyup',this._callEnter,true);}this._contextualDialogController=new s(this._threadID,ge);},_initializeCloseButton:function(){if(r.get('chat_react_header')){this._closeButton=sb.render(sb.createElement(q,{onClick:this._closeClicked.bind(this),onKeyUp:this._closeEnter.bind(this),onMouseDown:this._closePreClicked.bind(this)}),this._getNode('closeButtonContainer'));}else{this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);}},_initializeTitle:function(){if(r.get('chat_react_header')){var ge=ed.getThreadMetaNow(this._threadID);this._title=sb.render(sb.createElement(fa,{isNewThread:ed.isNewEmptyLocalThread(this._threadID),thread:ge,viewer:ka.getID()}),this._getNode('titleContainer'));}},setFileUploader:function(ge){this._fileUploader=ge;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=sb.render(sb.createElement(v,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_handlePUSubmit:function(ge,he){be(this,pb.UPLOAD_START,he);ud(this,'',[],function(ie){if(this._threadID!==ie.thread_id){this._newThreadIDFromPhotoUpload=ie.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(ie.thread_id);}ie.content_attachment=null;zc.sendPendingUploadStartedMessage(ie,he.upload_id,he);}.bind(this));fe('submit',he);this._focusInput();},_handlePULastUploadFailed:function(ge,he){be(this,pb.CLIENT_ERROR,he);fe('failed',he);zc.cancelPendingUploadStartedMessage(he.upload_id,he);var ie="\u0e01\u0e32\u0e23\u0e2d\u0e31\u0e1f\u0e42\u0e2b\u0e25\u0e14\u0e23\u0e39\u0e1b\u0e20\u0e32\u0e1e\u0e25\u0e49\u0e21\u0e40\u0e2b\u0e25\u0e27",je="Please try again. Make sure you are uploading a valid photo.";new na().setTitle(ie).setBody(je).setButtons(na.OK).show();},_handlePULastUploadCanceled:function(ge,he){be(this,pb.CANCEL_DURING_UPLOAD,he);fe('canceled',he);zc.cancelPendingUploadStartedMessage(he.upload_id,he);},_handlePUAllUploadsCompleted:function(ge,he){be(this,pb.ALL_UPLOADS_DONE,he);fe('completed',he);zc.confirmPendingUploadStartedMessage(he.upload_id,he);var ie=he.image_ids.length||he.attachments.length;td(this,ie);},_stickerSelected:function(ge){ud(this,'',[],function(he){he.has_attachment=true;he.sticker_id=ge;zc.sendMessage(he);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(ge){var he=ta.symbols[ge];if(!he)return;if(r.get('chat_react_input')){this._chatInput.insertEmoticon(he);return;}this._selectionPosition=this._selectionPosition||new ub(this._getNode('input'));var ie=fc.getInstance(this._getNode('input')),je=ie.getValue(),ke=ua.insertEmoticon(he,je,this._selectionPosition.getPos());ie.setValue(ke.result);this._selectionPosition.setPos(ke.start,ke.end);},_clearStickerSearchNUXIndicator:function(){la.removeClass(this._getNode('emoticonIndicator'),'nux');},_orionTriggered:function(){ud(this,'',[],function(ge){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){la.addClass(this._getNode('emoticonIndicator'),'nux');id=false;},_clearStickerSearchNUXTooltip:function(){this._stickerSearchNUXTooltip&&this._stickerSearchNUXTooltip.hideNUX();},_onFlyoutShown:function(ge){if(r.get('chat_react_sticker_button')){var he=this._stickersFlyout.props.packID;if(he!==xb.SEARCH_PACK_ID)this.focus();}if(wb.WebStickerTrigger){this._stickerTriggerController.onFlyoutShown(ge);}else ge();this._stickersFlyoutShown=true;},_searchStickers:function(ge,he){this._stickersFlyout.isMounted()&&this._stickersFlyout.setProps({packID:xb.SEARCH_PACK_ID,trigger:ge},he);},_onFlyoutHidden:function(){this._stickersFlyoutShown=false;this.focus();},_setTitleHref:function(ge){if(r.get('chat_react_header')){this._title.isMounted()&&this._title.setProps({href:ge});}else{var he=this._getNode('titlebarText');he.setAttribute('href',ge);he.removeAttribute('rel');la.removeClass(he,'noLink');}},_onAddMention:function(ge){this._linkDropped(ge.getURI());}});function fe(ge,he){kd.debug('photo_uploader:'+ge,Object.assign({},he));}e.exports=ce;},null);
__d("ChatNewMessageHandler",["ArbiterMixin","ChatActivity","ChatMentionsNotifications","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","MercuryConfig","MercuryThreadlistConstants","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=l.create('chat_new_message'),t={_raiseNewMessageTab:function(u,v){var w=j.getTab(u),x=false;if(w){x=w.raised;}else x=true;t.inform('chat/new-message-from-server',{thread_id:u});v.to_new_tab=!w;v.to_raised_tab=!!x;},_notify:function(u,v,w){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(v);var x=k.get(u);w.view_is_visible=x&&x.isVisible();w.view_is_focused=x&&x.isFocused();if(!w.view_is_visible)s.log('message_to_hidden');w.is_active=h.isActive();n.messageReceived(v);},newMessage:function(u,v,w){m.isThreadID(u);var x={thread_id:u,message_id:v.message_id};this._raiseNewMessageTab(u,x);this._notify(u,v,x);s.log('message',x);}};r(t,g);n.subscribe('before-alert',function(u,event){var v=event.threadID,w=k.get(v),x=j.getTab(v),y=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(x&&x.raised&&w&&w.isVisible()&&w.isFocused()&&o.isActive(y)){w.tryMarkAsRead();event.cancelAlert();}});e.exports=t;},null);
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return (void 0);var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;},null);
__d("ChatTabPolicy",["ChatBehavior","JSLogger","MercuryActionTypeConstants","MercuryLogMessageType","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MercuryViewer","MessagingTag","PresencePrivacy","ShortProfiles","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryUnseenState').get(),v=h.create('tab_policy');function w(x,y){u.markThreadSeen(x,y);}e.exports={messageIsAllowed:function(x,y,z){var aa=x.thread_id,ba=y.message_id;k.isThreadID(aa);k.isParticipantID(y.author);var ca;if(p.isThreadMuted(x)){ca={thread_id:aa,message_id:ba,mute_settings:x.mute_settings};v.log('message_thread_muted',ca);return;}if(x.mode==o.OBJECT_ORIGINATED){ca={thread_id:aa,message_id:ba,mode:x.mode};v.log('message_object_originated',ca);return;}if(y.source==n.EMAIL||y.source==n.TITAN_EMAIL_REPLY){ca={thread_id:aa,message_id:ba,source:y.source};v.log('message_source_not_allowed',ca);return;}var da=l.getUserIDFromParticipantID(y.author);if(!da){v.log('message_bad_author',{thread_id:aa,message_id:ba,user:da});return;}if(y.action_type!=i.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(y,x)){ca={thread_id:aa,message_id:ba,type:y.action_type};v.log('message_non_user_generated',ca);return;}if(x.is_canonical_user&&!g.notifiesUserMessages()){v.log('message_jabber',{thread_id:aa,message_id:ba});w(aa,true);return;}if(x.is_canonical&&!x.canonical_fbid){v.log('message_canonical_contact',{thread_id:aa,message_id:ba});return;}if(x.folder!=r.INBOX){v.log('message_folder',{thread_id:aa,message_id:ba,folder:x.folder});return;}var ea=l.getUserIDFromParticipantID(q.getID());t.getMulti([da,ea],function(fa){if(!s.allows(da)){v.log('message_privacy',{thread_id:aa,message_id:ba,user:da});return;}var ga=fa[da].employee&&fa[ea].employee;if(!ga&&fa[da].type!==m.FRIEND){v.log('message_non_friend',{thread_id:aa,message_id:ba,user:da});return;}z();});},_messageIsNewlyCreatedGroup:function(x,y){return x.action_type===i.LOG_MESSAGE&&x.log_message_type===j.THREAD_NAME&&y.message_count===1;}};},null);
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreadInformer').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadMetadataRenderer').get();function t(u){var v=n[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new m().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=r.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=n[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');s.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);o.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));o.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});o.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});q.subscribe('threads-updated',ba);}p(t,new h());e.exports=t;},null);
__d("ChatTabController",["Arbiter","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabLRUManager","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryConfig","MercuryIDs","MercuryParticipants","MercuryViewer","StickerState","Style","UserAgent_DEPRECATED","VideoCallCore","ChatTabPresence","ChatTypeaheadBehavior","MercuryThreadInformer","MercuryThreadActions","MercuryThreads","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b('ChatTabPresence');b('ChatTypeaheadBehavior');var z=b('MercuryThreadInformer').get(),aa=b('MercuryThreadActions').get(),ba=b('MercuryThreads').get(),ca=b('MercuryUnseenState').get(),da=i.get('tab_auto_close_timeout')||7200000,ea=q.create('tab_controller');function fa(ta){aa.markRead(ta);ga(ta);}function ga(ta){ca.markThreadSeen(ta);}function ha(ta,ua,va){var wa=m.get().tabs;ta+=ua?1:-1;while(ta>=0&&ta<wa.length){var xa=wa[ta],ya=o.get(xa.id);if(ya&&ya.isVisible()&&(!va||xa.raised)){ya.focus();return true;}ta+=ua?1:-1;}return false;}function ia(ta,ua){var va=ua&&ua.getRightmostHiddenTab();if(va===ta)return null;return va;}function ja(){return Math.floor(Math.random()*2147483648).toString(16);}function ka(ta,ua,va,wa){m.raiseTab(ta,true,va);var xa=ua&&ua.getLeftmostVisibleTab(),ya=ua&&ua.getTabsToShow();if(ya&&!ya[ta]&&xa){m.promoteThreadInPlaceOfThread(ta,xa,ia(ta,ua),true);}else m.setPromotedTab(ta);g.inform('chat/open-tab',ta);var za=o.get(ta);za&&za.focus();}function la(ta,ua,va){var wa=va.forceDrop();if(!m.getTab(ta))m.raiseTab(ta,false);if(wa)return;var xa=ua&&k.getLRUVisibleTab(ua),ya=ua&&ua.getTabsToShow();if(ya&&!ya[ta]&&xa)m.promoteThreadInPlaceOfThread(ta,xa,ia(ta,ua));}function ma(ta,ua){var va=m.indexOf(ta);m.closeTab(ta,ua);return va;}function na(ta,ua){j.subscribe('chat/new-message-from-server',function(db,eb){la(eb.thread_id,ta,ua);});p.subscribe('selected',function(db,eb){ka(eb,ta);});g.subscribe('chat/tabs-order-changed',function(db,eb){m.changeShowingTabs(eb);});g.subscribe('page_transition',function(db,eb){m.closeFragileTabs();});g.subscribe('chat/close-all-tabs',function(){m.closeAllTabs();});g.subscribe('chat-visibility/go-offline',function(){m.closeAllTabs();});g.subscribe('chat/close-tab',function(db,eb,fb){m.closeTab(eb,fb);});o.subscribe('read',function(event,db){fa(db);});h.subscribe('idle',function(db,eb){if(eb>da){var fb=m.get().tabs;fb.forEach(function(gb){var hb=gb.id;ba.getThreadMeta(hb,function(ib){if(!ib.unread_count){ea.log('autoclose_idle_seen',{thread_id:hb,idleness:eb});m.closeTab(hb,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(db,eb){ka(eb,ta);});o.subscribe('lower-activated',function(db,eb){m.lowerTab(eb);var fb=o.get(eb);fb&&fb.focus();});o.subscribe('focus-tab',function(db,eb){var fb=m.getTab(eb);if(fb&&fb.raised)ka(eb,ta,fb.signatureID,true);});function va(db,eb){y.showOutgoingCallDialog(eb.userID,eb.clickSource);}o.subscribe('video-call-clicked',va);l.subscribe('video-call-clicked',va);l.subscribe('interaction-with-tab',function(db,eb){var fb=m.getTab(eb);fb&&fb.raised&&ga(eb);});o.subscribe('closed-tab',function(db,eb){ea.log('close_view',{thread_id:eb});ma(eb,'close_view');return false;});o.subscribe('thread-deleted',function(db,eb){ea.log('close_thread_deleted',{thread_id:eb});ma(eb,'close_thread_deleted');return false;});o.subscribe('unsubscribed',function(db,eb){ea.log('close_view_unsubscribed',{thread_id:eb});ma(eb,'close_view_unsubscribed');return false;});o.subscribe('esc-pressed',function(db,eb){ea.log('close_esc',{thread_id:eb});var fb=ma(eb,'close_esc');setTimeout(function(){ha(fb-1,true,true)||ha(fb,false,true);},0);});p.subscribe('selector/close-tab',function(db,eb){ea.log('close_chat_from_selector',{thread_id:eb});ma(eb,'close_chat_from_selector');});z.subscribe('messages-received',function(db,eb){for(var fb in eb){var gb=eb[fb];for(var hb=0;hb<gb.length;hb++){var ib=gb[hb];if(ib.author!=u.getID()){if(!ib.is_unread){ea.log('message_already_read',{action_id:ib.action_id,thread_id:ib.thread_id});continue;}ba.getThreadMeta(fb,function(jb){n.messageIsAllowed(jb,ib,function(){j.newMessage(fb,ib,ta);});});}}}});z.subscribe('thread-read-changed',function(db,eb){for(var fb in eb)if(!eb[fb].mark_as_read){ea.log('autoclose_marked_unread',{thread_id:fb});m.closeTab(fb,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(db,eb){return !ha(m.indexOf(eb.id),eb.shiftPressed);});g.subscribe(q.DUMP_EVENT,function(db,eb){eb.chat_controller={auto_close_timeout:da};});this.openTab=function(db,eb){ka(db,eb,ja());};var wa,xa,ya=[],za=[],ab=[],bb;if(v.shouldShowStickerSearchNUXTooltip()){wa=ta.getRightmostRaisedTab();if(wa){bb=o.get(wa);bb.showStickerSearchNUXTooltip();}else g.subscribeOnce('chat/open-tab',function(db,eb){bb=o.get(eb);bb.showStickerSearchNUXTooltip();});}else if(r.ShowOrionNUXTooltip){ya=ta.getRaisedVisibleTabs();for(var cb=0;cb<ya.length;cb++){xa=o.get(ya[cb]);if(xa.isOrionNUXEligible())za.push(xa);}if(za.length){ab=za.map(function(db){return db.getParticipantIDForOrionNUX();});t.getMulti(ab,function(db){for(var eb in db)if(db[eb].orion_eligible){bb=za.filter(function(fb){return fb._getCanonicalUserID()===s.getUserIDFromParticipantID(db[eb].id);})[0];break;}if(bb)bb.showOrionNUXTooltip();});}}}if(x.firefox()){var oa=function(){return w.get(document.body,'overflowX')+' '+w.get(document.body,'overflowY');},pa=oa(),qa=function(){var ta=oa();if(ta!==pa){pa=ta;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ra=new MutationObserver(qa),sa={attributes:true,attributeFilter:['class','style']};ra.observe(document.documentElement,sa);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))qa();},false);}e.exports=na;},null);
__d("ChatTabViewCoordinator",["Arbiter","BanzaiODS","Bootloader","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallSupport","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=n.create('chat_tab_coordinator'),t,u;function v(w,x){var y=new l(w),z={},aa={},ba=false;function ca(){var oa=j.get(),pa={};oa.tabs.forEach(function(ra){pa[ra.id]=1;});s.log('process_tab_changed',{model_tabs:Object.keys(pa),view_tabs:Object.keys(z)});for(var qa in z)if(!pa[qa]){s.log('remove_tab',{tab_id:qa});z[qa].destroy();delete(z[qa]);}da(oa);ma(oa);if(oa.tabNeedsFocus&&!oa.tabNeedsFocus.isFocused())oa.tabNeedsFocus.focus();}function da(oa){var pa=null;oa.tabs.forEach(function(qa){var ra=qa.id,sa=false;if(!z[ra]){s.log('add_tab',{tab_id:ra});z[ra]=new k(ra,qa.server_id,qa.signatureID,w,pa);sa=true;}else z[ra].updateSignatureID(qa.signatureID);if(z[ra].isFocused())oa.tabNeedsFocus=z[ra];if(!sa&&!z[ra].nextTabIs(pa)){var ta=z[ra].getScrollTop();if(pa){z[ra].insertBefore(pa);}else z[ra].appendTo(w);if(ta)z[ra].setScrollTop(ta);}pa=z[ra];});}function ea(){var oa=x.getShowingTabsOrder();if(!oa||!oa.length)return;var pa=z[oa[0].id]._tabElem,qa=z[oa[oa.length-1].id]._tabElem,ra=parseInt(o.get(qa,'margin-left'),10)||0,sa=p.getElementBounds(qa).l-2*ra;sa=sa>0?sa:0;t&&t.setBoundingBox(new p(0,p.getElementBounds(pa).r,0,sa));}function fa(oa,pa){var qa=false;pa.forEach(function(ta){if(ta.raised){if(aa[ta.id]){qa=true;delete aa[ta.id];}}else if(!aa[ta.id]){qa=true;aa[ta.id]=true;}});if(qa)return true;if(!t)return true;var ra=ga()||[];if(ra.length!==oa.length)return true;for(var sa=0;sa<oa.length;sa++)if(ra[sa]!==oa[sa].id)return true;return false;}function ga(){var oa=t&&t.getOrder();oa&&oa.reverse();return oa;}function ha(){var oa=ga();if(oa){h.bumpEntityKey('chat.web','tab.drag_order_changed');g.inform('chat/tabs-order-changed',oa);}}function ia(oa,pa,qa){if(z[qa]._scrollTop!=null)z[qa].setScrollTop(z[qa]._scrollTop);}function ja(oa,pa){u=pa;z[pa]._isDragDropActive=true;z[pa]._scrollTop=z[pa].getScrollTop();o.set(z[pa]._tabElem,'z-index',1);ea();h.bumpEntityKey('chat.web','tab.drag_started');}function ka(oa){o.set(z[oa]._tabElem,'z-index','');if(z[oa]._scrollTop!=null)z[oa].setScrollTop(z[oa]._scrollTop);z[oa]._scrollTop=null;u=null;setTimeout(function(){z[oa]._isDragDropActive=false;},0);}function la(oa){i.loadModules(["SortableGroup"],function(pa){var qa=x.getShowingTabsOrder(),ra=fa(qa,oa);if(qa.length<=1){t&&t.removeAllSortables();return;}if(ra){if(t){t.removeAllSortables();}else t=new pa().setBeforeGrabCallback(ja).setDragOverCallback(ia).setDropCallback(ka).setOrderChangeHandler(ha).setUseScroller(false).setDragOverHorizontally();for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];t.addSortable(ta.id,z[ta.id]._tabElem,aa[ta.id]?null:z[ta.id]._titlebar);}}});}function ma(oa){var pa=x.getTabsToShow(oa),qa=[],ra=false;oa.tabs.forEach(function(sa){if(!pa[sa.id]){z[sa.id].setVisibleState(false,sa.raised);qa.push(sa);}});oa.tabs.forEach(function(sa){if(pa[sa.id]){z[sa.id].setVisibleState(true,sa.raised);ra|=sa.raised;}});y.setTabData(qa);na(ra);la(oa.tabs);}function na(oa){if(!oa&&ba){g.inform('layer_hidden',{type:'ChatTab'});ba=false;}else if(oa&&!ba){g.inform('layer_shown',{type:'ChatTab'});ba=true;}}if(q.isVideoCallSupported())m.addClass(w,'videoCallEnabled');x.subscribe('tabs-changed',ca);ca();}r(v.prototype,{forceDrop:function(){if(t&&u){t.forceDrop(u);u=null;return true;}return false;}});e.exports=v;},null);
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f,g,h){var i={init:function(j,k,l){if(this._isInitialized){h.create('chat_app').error('repeated_init');return;}this._rootElem=j;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(m,n,o,p,q,r){q=q.get();q.turnOn();p.get().handleUpdate(l);this.tabsViewport=new m(k);this.tabViewCoordinator=new o(k,this.tabsViewport);this.tabController=new n(this.tabsViewport,this.tabViewCoordinator);this._isInitialized=this._isLoaded=true;}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(j){j.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};e.exports=i;},null);